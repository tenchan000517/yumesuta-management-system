# Google Apps Script 実行ガイド

**Phase 2-3 タスク管理機能 - Google Sheetsセットアップ手順**

---

## 📋 前提条件

- Google Sheetsのタスク管理スプレッドシートにアクセス可能であること
- スプレッドシートID: `1yUrlBRsbvUvVLrSukQO0N-TTygBxl7DY1OqDQgGY06k`
- URL: https://docs.google.com/spreadsheets/d/1yUrlBRsbvUvVLrSukQO0N-TTygBxl7DY1OqDQgGY06k

---

## ステップ1: シート作成（所要時間: 2分）

### 1-1. Google Apps Scriptエディタを開く

1. 上記のGoogle SheetsのURLをブラウザで開く
2. メニューバーから **拡張機能 → Apps Script** をクリック
3. Apps Scriptエディタが新しいタブで開く

### 1-2. スクリプトをコピー&ペースト

1. `/mnt/c/yumesuta-management-system/scripts/gas-create-task-sheets.js` を開く
2. **全内容をコピー**
3. Apps Scriptエディタの「コード.gs」に貼り付け（既存のコードを全て置き換え）
4. **保存アイコン（💾）をクリック** または `Ctrl+S`

### 1-3. 関数を実行

1. 関数選択ドロップダウンから **`createTaskSheets`** を選択
2. **実行ボタン（▶）をクリック**
3. 初回実行時、権限リクエストが表示される場合:
   - **「権限を確認」→ 自分のGoogleアカウントを選択**
   - **「詳細」→「（プロジェクト名）に移動」をクリック**
   - **「許可」をクリック**
4. 実行完了を待つ（数秒）

### 1-4. 実行結果を確認

1. Apps Scriptエディタ下部の **「ログ」タブ** をクリック
2. 以下のログが表示されればOK:
   ```
   既存シート削除完了
   ✅ タスクマスタシート作成完了
   ✅ タスク実施履歴シート作成完了
   ✅ 定期タスクスケジュールシート作成完了
   ✅ プロジェクトタスクシート作成完了
   ========================================
   ✅ 全4シート作成完了！
   次のステップ: populateTaskMaster() 関数を実行してデータを入力してください
   ========================================
   ```

3. Google Sheetsのタブに戻り、シートが作成されたことを確認:
   - タスクマスタ（青ヘッダー）
   - タスク実施履歴（緑ヘッダー）
   - 定期タスクスケジュール（黄ヘッダー）
   - プロジェクトタスク（赤ヘッダー）

---

## ステップ2: 35タスクデータ入力（所要時間: 1分）

### 2-1. スクリプトを切り替え

1. Apps Scriptエディタに戻る
2. `/mnt/c/yumesuta-management-system/scripts/gas-populate-task-master.js` を開く
3. **全内容をコピー**
4. Apps Scriptエディタの「コード.gs」に貼り付け（既存のコードを全て置き換え）
5. **保存アイコン（💾）をクリック** または `Ctrl+S`

### 2-2. 関数を実行

1. 関数選択ドロップダウンから **`populateTaskMaster`** を選択
2. **実行ボタン（▶）をクリック**
3. 実行完了を待つ（数秒）

### 2-3. 実行結果を確認

1. Apps Scriptエディタ下部の **「ログ」タブ** をクリック
2. 以下のログが表示されればOK:
   ```
   ========================================
   ✅ 35タスク入力完了！
   スプレッドシートID: 1yUrlBRsbvUvVLrSukQO0N-TTygBxl7DY1OqDQgGY06k
   シート名: タスクマスタ
   ========================================
   次のステップ:
   1. Google Sheetsでデータを確認してください
   2. マネジメントシステムダッシュボードで動作確認してください
      → http://localhost:3000/dashboard/tasks
   ========================================
   ```

3. Google Sheetsの **「タスクマスタ」シート** を開く
4. 35行のタスクデータ（TASK-001〜TASK-035）が入力されていることを確認

---

## ステップ3: ダッシュボードで動作確認（所要時間: 2分）

### 3-1. ローカルサーバー起動

```bash
cd /mnt/c/yumesuta-management-system
npm run dev
```

### 3-2. ダッシュボードにアクセス

1. ブラウザで `http://localhost:3000/dashboard/tasks` を開く
2. **「更新」ボタン** をクリック
3. タブを切り替えて確認:
   - **今日のタスク**: 今日実施すべきタスクが表示される（初期は空の可能性あり）
   - **定期タスク管理**: カレンダー/リスト表示が機能する
   - **プロジェクトタスク管理**: プロジェクト一覧が表示される（初期は空）
   - **タスクマスタ**: **35タスク全てが表示される** ✅

### 3-3. タスクマスタタブで確認すべきこと

- ✅ 35タスク全てが表示されている
- ✅ フィルタ機能が動作する（カテゴリ、頻度、優先度、リスク）
- ✅ 検索機能が動作する
- ✅ 各タスクの「詳細」ボタンをクリックすると詳細モーダルが表示される
- ✅ 関連URLボタンをクリックすると別タブで開く
- ✅ 関連パスボタンをクリックするとクリップボードにコピーされる
- ✅ コマンドコピーボタンをクリックするとクリップボードにコピーされる

---

## ⚠️ トラブルシューティング

### エラー: 「タスクマスタシートが見つかりません」

**原因**: `createTaskSheets()` 関数を実行していない

**対処法**: ステップ1に戻り、`createTaskSheets()` 関数を先に実行する

---

### エラー: 権限エラー「このアプリはGoogleで確認されていません」

**対処法**:
1. 「詳細」をクリック
2. 「（プロジェクト名）に移動」をクリック
3. 「許可」をクリック

---

### エラー: ダッシュボードで「更新」ボタンをクリックしてもデータが表示されない

**原因1**: `.env.local` に `TASKS_SPREADSHEET_ID` が設定されていない

**対処法**:
```bash
# .env.local に追加
TASKS_SPREADSHEET_ID=1yUrlBRsbvUvVLrSukQO0N-TTygBxl7DY1OqDQgGY06k
```

**原因2**: サービスアカウントに権限がない

**対処法**:
1. Google Sheetsの「共有」ボタンをクリック
2. サービスアカウントのメールアドレスを追加（編集者権限）
3. サービスアカウントメールアドレスは `.env.local` の `GOOGLE_SERVICE_ACCOUNT_KEY` の `client_email` フィールドに記載

---

## 📝 次のステップ

### Phase 2-3完了後のタスク

1. ✅ シート作成完了
2. ✅ 35タスクデータ入力完了
3. ✅ ダッシュボード動作確認完了
4. ⏳ 定期タスクスケジュールにサンプルデータ入力（任意）
5. ⏳ プロジェクトタスクにサンプルデータ入力（任意）
6. ⏳ Phase 2-3完了報告

---

**作成日**: 2025-10-05
**作成者**: Claude Code
**対象**: Phase 2-3 タスク管理機能実装フェーズ
