/**
 * タスクマスタスプレッドシートデータ入力スクリプト
 *
 * 35タスクのデータをGoogle Sheetsのタスクマスタシートに一括入力
 */

const { google } = require('googleapis');
const fs = require('fs');
const path = require('path');

// .env.localファイルを読み込み
const envPath = path.resolve(__dirname, '../.env.local');
const envContent = fs.readFileSync(envPath, 'utf8');

// 環境変数をパース
const env = {};
envContent.split('\n').forEach(line => {
  const match = line.match(/^([^=]+)=(.*)$/);
  if (match) {
    const key = match[1].trim();
    const value = match[2].trim().replace(/^["']|["']$/g, ''); // 引用符を削除
    env[key] = value;
  }
});

// 認証情報を取得
const serviceAccountKey = JSON.parse(env.GOOGLE_SERVICE_ACCOUNT_KEY || '{}');
const spreadsheetId = env.TASKS_SPREADSHEET_ID;

// 35タスクのデータ
const taskMasterData = [
  // 調査1: パートナー管理（6タスク）
  [
    'TASK-001',
    'Google Sheetsにパートナー基本情報入力',
    'パートナー管理',
    '不定期',
    '新規パートナー追加時・情報変更時',
    '15〜20分',
    '高',
    '中',
    'https://docs.google.com/spreadsheets/d/12A5mroEA5ipsIM88y4GOTmK61-V95bnAV5eTEhejvpc',
    'パートナー・スターデータスプレッドシート',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    'パートナーから受領した情報（企業名、代表者名、業種等）を入力',
    '',
    '画像ファイル名を確認してから実行',
  ],
  [
    'TASK-002',
    'パートナー画像の準備・配置',
    'パートナー管理',
    '不定期',
    '新規パートナー追加時',
    '5分',
    '高',
    '低',
    '',
    '',
    '',
    '',
    '',
    '',
    '/mnt/c/yumesuta-management-system/public/partner-images/raw/',
    '画像配置先ディレクトリ',
    '',
    '',
    '',
    '受領した画像ファイル（ロゴ、代表者写真、QR）',
    'TASK-001',
    '',
  ],
  [
    'TASK-003',
    '画像処理スクリプト実行（リネーム・URL生成）',
    'パートナー管理',
    '不定期',
    '新規パートナー追加時',
    '2〜3分',
    '高',
    '中',
    '',
    '',
    '',
    '',
    '',
    '',
    '/mnt/c/yumesuta-management-system/scripts/process-partner-images.js',
    '画像処理スクリプト',
    '',
    '',
    'node scripts/process-partner-images.js',
    'Google Sheetsに基本情報入力済みであること',
    'TASK-001,TASK-002',
    '',
  ],
  [
    'TASK-004',
    'Xserverに画像アップロード',
    'パートナー管理',
    '不定期',
    '画像処理スクリプト実行後',
    '10〜15分',
    '高',
    '高',
    'https://yumesuta.com/partner-images/',
    'Xserver画像アップロード確認URL',
    '',
    '',
    '',
    '',
    '/mnt/c/yumesuta-management-system/public/partner-images/processed/',
    'アップロード元ディレクトリ',
    '',
    '',
    '',
    'FTPクライアント（FileZilla等）でXserverに接続',
    'TASK-003',
    '',
  ],
  [
    'TASK-005',
    'yumesutaHP更新（スタートプロンプト実行）',
    'パートナー管理',
    '不定期',
    'Xserverアップロード後',
    '5〜10分',
    '最高',
    '高',
    '',
    '',
    '',
    '',
    '',
    '',
    '/mnt/c/yumesuta-management-system/docs/workflows/update-yumesutahp-partners-prompt.md',
    'スタートプロンプトファイル',
    '',
    '',
    '',
    'スタートプロンプトをClaude Codeに貼り付け',
    'TASK-004',
    '',
  ],
  [
    'TASK-006',
    'yumesutaHP確認・デプロイ',
    'パートナー管理',
    '不定期',
    'スタートプロンプト実行後',
    '5〜10分',
    '高',
    '中',
    'http://localhost:3000',
    '開発サーバーURL',
    '',
    '',
    '',
    '',
    '/mnt/c/yumesutaHP',
    'yumesutaHPディレクトリ',
    '',
    '',
    'cd /mnt/c/yumesutaHP && npm run dev',
    'TOPページ・パートナーページ・画像表示確認',
    'TASK-005',
    '',
  ],

  // 調査2: 営業管理（4タスク）
  [
    'TASK-007',
    '毎日の営業KPI確認・分析',
    '営業管理',
    '毎日',
    '毎日朝・夕',
    '10〜15分',
    '最高',
    '高',
    'https://docs.google.com/spreadsheets/d/13PzSnGekGxDWX7B1_TwczNibR6j_JxDb3UuquPX1GyQ',
    '営業管理スプレッドシート',
    'http://localhost:3000/dashboard/sales',
    'マネジメントシステム営業ダッシュボード',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '営業日の進捗率・各指標の過不足・転換率・ゆめマガ配布状況確認',
    '',
    '',
  ],
  [
    'TASK-008',
    '営業指示出し（PDCA）',
    '営業管理',
    '毎日',
    '毎日〜毎週（状況に応じて）',
    '20〜30分',
    '最高',
    '高',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    'TELアポ不足時の追加架電指示、転換率低下時の見直し指示等',
    'TASK-007',
    '',
  ],
  [
    'TASK-009',
    '営業先リスト作成・更新',
    '営業管理',
    '週次',
    '週1回〜月1回',
    '30分〜1時間',
    '高',
    '中',
    'https://docs.google.com/spreadsheets/d/13PzSnGekGxDWX7B1_TwczNibR6j_JxDb3UuquPX1GyQ',
    '営業先リストシート',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '新規営業先の追加、既存営業先のステータス更新、優先順位の見直し',
    '',
    '',
  ],
  [
    'TASK-010',
    'ゆめマガ配布管理',
    '営業管理',
    '月次',
    '毎月',
    '20〜30分',
    '高',
    '中',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '配布校数・配布部数の確認、未配布校への配布促進',
    '',
    '',
  ],

  // 調査3: ゆめマガ制作（6タスク）
  [
    'TASK-011',
    '毎日のゆめマガ制作進捗確認',
    'ゆめマガ制作',
    '毎日',
    '毎日朝',
    '10〜15分',
    '最高',
    '高',
    'https://docs.google.com/spreadsheets/d/1qC3cMSGv8kjt6aoK20IvbaFfD3oLfvTTrFKUU_gQXhw',
    'Phase4逆算スケジューラー',
    'http://localhost:3000/dashboard/yumemaga',
    'マネジメントシステムゆめマガダッシュボード',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '遅延工程の有無、進行中工程の状況、本日実施すべき工程、外部依存工程の状況',
    '',
    '',
  ],
  [
    'TASK-012',
    '制作スタッフへの指示出し・確認',
    'ゆめマガ制作',
    '週次',
    '毎日〜週2-3回',
    '20〜30分',
    '最高',
    '高',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '遅延工程への対応指示、次に進むべき工程の確認、外注管理、納期調整',
    'TASK-011',
    '',
  ],
  [
    'TASK-013',
    'コンテンツ確認・校正',
    'ゆめマガ制作',
    '週次',
    '週2-3回（コンテンツ完成時）',
    '30分〜1時間',
    '高',
    '中',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    'ページレイアウト、コピーライティング、誤字脱字、写真配置・レタッチ、ブランディング一貫性',
    '',
    '',
  ],
  [
    'TASK-014',
    '先方（企業・学校・STAR）への確認送付・修正対応',
    'ゆめマガ制作',
    '週次',
    '週1-2回',
    '15〜30分',
    '最高',
    '高',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '確認用PDF準備、メール送信、修正依頼受領、修正指示出し、再送付',
    'TASK-013',
    '',
  ],
  [
    'TASK-015',
    '次月号の企画決定・準備',
    'ゆめマガ制作',
    '月次',
    '月1回（当月号制作中の25-30日目）',
    '2〜3時間',
    '最高',
    '高',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    'メインインタビュー企画決定、企画書作成、インタビュー実施日調整、学校訪問・カスタム企画調整',
    '',
    '',
  ],
  [
    'TASK-016',
    '最終チェック・校了・入稿管理',
    'ゆめマガ制作',
    '月次',
    '月1回（納期直前・Z系工程）',
    '4〜6時間',
    '最高',
    '最高',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '全ページ最終チェック、校了判定、入稿データ準備、印刷会社への入稿、入稿確認',
    'TASK-011,TASK-012,TASK-013,TASK-014,TASK-015',
    '',
  ],

  // 調査4: HP・LLMO（6タスク）
  [
    'TASK-017',
    'ターゲットキーワードの順位確認・分析',
    'HP・LLMO',
    '週次',
    '週1回（毎週月曜日）',
    '15〜20分',
    '高',
    '高',
    'https://search.google.com/search-console?resource_id=sc-domain:yumesuta.com',
    'Google Search Console',
    'http://localhost:3000/dashboard/analytics',
    'マネジメントシステムAnalyticsダッシュボード',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    'ターゲットキーワードごとの現在順位、前週からの順位変動、クリック数・表示回数・CTRの変化',
    '',
    '',
  ],
  [
    'TASK-018',
    'AI検索（LLMO）での表示状況確認',
    'HP・LLMO',
    '週次',
    '週1回（タスク017と同時）',
    '20〜30分',
    '中',
    '中',
    'https://chat.openai.com',
    'ChatGPT',
    'https://www.perplexity.ai',
    'Perplexity',
    'https://gemini.google.com',
    'Google Gemini',
    '',
    '',
    '',
    '',
    '',
    '各AI検索エンジンでのyumesuta.com言及状況、どのプロンプトで表示されるか、競合との比較',
    '',
    '',
  ],
  [
    'TASK-019',
    'お問い合わせ獲得状況の確認・分析',
    'HP・LLMO',
    '週次',
    '週1回（タスク017・018と同時）',
    '10〜15分',
    '高',
    '中',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '週間お問い合わせ件数、流入元別お問い合わせ数、ランディングページ別お問い合わせ数',
    '',
    '',
  ],
  [
    'TASK-020',
    'SEO施策の立案・実行',
    'HP・LLMO',
    '月次',
    '月1〜2回（分析結果に基づいて）',
    '2〜3時間',
    '高',
    '中',
    '',
    '',
    '',
    '',
    '',
    '',
    '/mnt/c/yumesutaHP',
    'yumesutaHPディレクトリ',
    '',
    '',
    '',
    'メタディスクリプション最適化、見出しタグ改善、alt属性詳細記述、構造化データ追加',
    'TASK-017',
    '',
  ],
  [
    'TASK-021',
    'HP更新・新規コンテンツ作成',
    'HP・LLMO',
    '月次',
    '月1〜2回（SEO施策に応じて）',
    '3〜5時間',
    '中',
    '低',
    'https://www.canva.com/',
    'CANVA（デザイン作成用）',
    '',
    '',
    '',
    '',
    '/mnt/c/yumesutaHP',
    'yumesutaHPディレクトリ',
    '',
    '',
    '',
    '新規ページ作成、コンテンツ執筆、画像・デザイン作成、内部リンク設定',
    '',
    '',
  ],
  [
    'TASK-022',
    'アクセス解析レポート作成・共有',
    'HP・LLMO',
    '月次',
    '月1回（月初）',
    '30分〜1時間',
    '中',
    '中',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '月次データ集計、前月比較、主要指標サマリー、課題・改善点抽出、次月の施策提案',
    'TASK-017,TASK-018,TASK-019',
    '',
  ],

  // 調査5: SNS（7タスク）
  [
    'TASK-023',
    '投稿コンテンツ作成（画像・テキスト）',
    'SNS',
    '週次',
    '週2〜3回',
    '30分〜1時間',
    '高',
    '中',
    'https://www.canva.com/',
    'CANVA（デザイン作成用）',
    'https://docs.google.com/spreadsheets/d/12A5mroEA5ipsIM88y4GOTmK61-V95bnAV5eTEhejvpc',
    'パートナー・スターデータ',
    'https://docs.google.com/spreadsheets/d/17ntd2gbXXxqOVmNzZ8AMWxDOBeg0A8F8F_9mCLct-BM',
    'SNS投稿予定スプレッドシート',
    '/mnt/c/yumesuta-management-system/public/partner-images/',
    '画像素材フォルダ',
    '',
    '',
    '',
    '投稿内容の企画・決定、画像デザイン作成、テキストコピーライティング、ハッシュタグ選定',
    '',
    '',
  ],
  [
    'TASK-024',
    '投稿スケジュール管理・予約投稿設定',
    'SNS',
    '週次',
    '週1回（投稿予定の確認・調整）',
    '15〜20分',
    '高',
    '高',
    'https://docs.google.com/spreadsheets/d/17ntd2gbXXxqOVmNzZ8AMWxDOBeg0A8F8F_9mCLct-BM',
    'SNS投稿予定スプレッドシート',
    'http://localhost:3000/dashboard/sns',
    'マネジメントシステムSNSダッシュボード',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '今週の投稿予定件数、期限切れ投稿の有無、投稿予定日時の調整、アカウント別の投稿バランス',
    'TASK-023',
    '',
  ],
  [
    'TASK-025',
    '実際の投稿実行（手動投稿）',
    'SNS',
    '週次',
    '週2〜3回（投稿予定に応じて）',
    '5〜10分',
    '高',
    '中',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    'Instagram/Xにログイン、投稿内容・画像を投稿、リンクURL・ハッシュタグを追加',
    'TASK-024',
    '',
  ],
  [
    'TASK-026',
    '投稿後のエンゲージメント確認',
    'SNS',
    '週次',
    '週1回（投稿後2〜3日以内）',
    '15〜20分',
    '中',
    '中',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    'いいね数・コメント数、リーチ数・インプレッション数、リンククリック数、フォロワー増減',
    'TASK-025',
    '',
  ],
  [
    'TASK-027',
    '被リンク獲得状況の確認・分析',
    'SNS',
    '週次',
    '週1回（タスク026と同時）',
    '10〜15分',
    '中',
    '中',
    'https://search.google.com/search-console?resource_id=sc-domain:yumesuta.com',
    'Google Search Console（被リンク確認）',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '各被リンクアカウントの投稿からのリンククリック数、yumesuta.comへの流入状況',
    '',
    '',
  ],
  [
    'TASK-028',
    'ブランディング効果の測定・分析',
    'SNS',
    '月次',
    '月1回',
    '20〜30分',
    '中',
    '低',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    'フォロワー増減数、エンゲージメント率の推移、投稿内容別のエンゲージメント傾向',
    'TASK-026',
    '',
  ],
  [
    'TASK-029',
    'SNS投稿戦略の見直し・改善',
    'SNS',
    '月次',
    '月1回（タスク028と同時）',
    '30分〜1時間',
    '中',
    '中',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '高エンゲージメント投稿パターンの特定、被リンク獲得効果の高い投稿タイプの特定',
    'TASK-028',
    '',
  ],

  // 調査6: 請求書（6タスク）
  [
    'TASK-030',
    '請求書発行',
    '請求書',
    '月次',
    '月1〜3回（請求サイクルに応じて）',
    '15〜30分',
    '最高',
    '高',
    'https://invoice.moneyforward.com/',
    'マネーフォワード クラウド請求書',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '請求書作成、PDF生成、請求書送付（メール or 郵送）、ステータス更新',
    '',
    '',
  ],
  [
    'TASK-031',
    '入金確認（キャッシュアウト防止）',
    '請求書',
    '毎日',
    '毎日〜週2-3回',
    '10〜20分',
    '最高',
    '最高',
    'https://receivable.moneyforward.com/',
    'マネーフォワード クラウド債権管理',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '支払期限到来の請求書、入金予定日の請求書、入金遅延の請求書、入金額・請求額の照合',
    'TASK-030',
    '',
  ],
  [
    'TASK-032',
    '未入金アラート対応・督促',
    '請求書',
    '週次',
    '週1回（マネーフォワードの未入金アラートメール受信時）',
    '20〜30分',
    '高',
    '高',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '未入金請求書の状況確認、督促判断、督促実施（メール・電話）、督促履歴記録',
    'TASK-031',
    '',
  ],
  [
    'TASK-033',
    '取引先情報更新・管理',
    '請求書',
    '不定期',
    '不定期（取引先追加・情報変更時）',
    '10〜15分',
    '中',
    '中',
    'https://invoice.moneyforward.com/',
    'マネーフォワード クラウド請求書（取引先マスタ）',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '取引先マスタ登録・更新、インボイス登録番号確認・登録、自動補助科目作成確認',
    '',
    '',
  ],
  [
    'TASK-034',
    '売上データ分析・レポート作成',
    '請求書',
    '月次',
    '月1回（月初）',
    '30分〜1時間',
    '中',
    '低',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '月間請求額、取引先別売上、売上推移、未入金額・回収率、売上目標達成率',
    'TASK-030,TASK-031',
    '',
  ],
  [
    'TASK-035',
    'マネーフォワード クラウド会計との連携確認',
    '請求書',
    '月次',
    '月1回（請求書発行後・月次締め時）',
    '10〜20分',
    '中',
    '中',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '',
    '請求書 → 売上仕訳の連携状況、売掛金補助科目の自動作成状況、仕訳データの正確性',
    'TASK-030',
    '',
  ],
];

async function main() {
  try {
    console.log('タスクマスタスプレッドシートへのデータ入力を開始します...\n');

    // Google Sheets API認証
    const auth = new google.auth.JWT({
      email: serviceAccountKey.client_email,
      key: serviceAccountKey.private_key,
      scopes: ['https://www.googleapis.com/auth/spreadsheets'],
    });

    const sheets = google.sheets({ version: 'v4', auth });

    // ヘッダー行を作成
    const header = [
      'タスクID',
      'タスク名',
      'カテゴリ',
      '頻度種別',
      '頻度詳細',
      '所要時間',
      '優先度',
      '抜けもれリスク',
      '関連URL1',
      '関連URL1名称',
      '関連URL2',
      '関連URL2名称',
      '関連URL3',
      '関連URL3名称',
      '関連パス1',
      '関連パス1名称',
      '関連パス2',
      '関連パス2名称',
      '関連コマンド',
      '関連情報',
      '依存タスクID',
      '備考',
    ];

    // データ全体（ヘッダー + 35タスク）
    const allData = [header, ...taskMasterData];

    // タスクマスタシートにデータを書き込み
    await sheets.spreadsheets.values.update({
      spreadsheetId,
      range: 'タスクマスタ!A1:V36', // ヘッダー + 35タスク = 36行
      valueInputOption: 'RAW',
      requestBody: {
        values: allData,
      },
    });

    console.log('✅ タスクマスタシートへのデータ入力が完了しました！');
    console.log(`   - 入力タスク数: ${taskMasterData.length}タスク`);
    console.log(`   - スプレッドシートID: ${spreadsheetId}`);
    console.log(`   - シート名: タスクマスタ\n`);

    console.log('次のステップ:');
    console.log('1. Google Sheetsでデータを確認してください');
    console.log('2. 他の3シート（タスク実施履歴、定期タスクスケジュール、プロジェクトタスク）にもヘッダーを追加してください');
    console.log('3. `npm run dev` でダッシュボードを起動し、「更新」ボタンでデータを取得してください\n');
  } catch (error) {
    console.error('❌ エラーが発生しました:', error);
    process.exit(1);
  }
}

main();
