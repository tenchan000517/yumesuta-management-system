# 次世代Claude Code引き継ぎ書 - ゆめマガ進捗管理改善

**作成日**: 2025-10-07
**前提**: 先方確認ステータス機能の実装が完了済み

---

## 📍 現在の状況

### 完了した作業
1. ✅ 進捗入力シートの列構造整備（月号・先方確認ステータス列追加）
2. ✅ 新工程マスターとの同期機能
3. ✅ ガントチャートからの予定日取得
4. ✅ 先方確認ステータスの更新・表示機能（カテゴリ単位で「確認送付」工程を更新）

### 現在のシステム構成

**データソース**:
- スプレッドシートID: `環境変数YUMEMAGA_SPREADSHEET_ID`
- 主要シート:
  - **新工程マスター**: 全97工程の定義
  - **逆算配置_ガント_[月号]**: スケジュール（予定日）
  - **進捗入力シート**: 実績データ（A列:工程No, B列:工程名, G列:実績日, H列:先方確認ステータス）
  - **新依存関係マスター**: 工程間の依存関係
  - **設定マスター**: 各種設定（カテゴリ設定など）

**主要ページ**:
- `/app/dashboard/yumemaga-v2/page.tsx` - メイン進捗管理画面
- `/app/dashboard/yumemaga-sheets/page.tsx` - シート管理画面

**主要API**:
- `/api/yumemaga-v2/progress` - カテゴリ別進捗取得
- `/api/yumemaga-v2/processes` - 工程一覧取得
- `/api/yumemaga-v2/confirmation-status` - 先方確認ステータス更新
- `/api/yumemaga-v2/actual-date` - 実績日更新

---

## 🎯 次にやること

### ステップ1: 要件定義の確認
まず `docs/yumemaga-production-management/IMPROVEMENT_REQUIREMENTS.md` を読んでください。
これにユーザーの要件がすべて記載されています。

### ステップ2: 徹底的な調査

以下を調査してください：

#### 2-1. スプレッドシートの全体構造調査
```bash
# 調査用APIを作成して、各シートの構造を確認
# - 新工程マスター: 全97工程の詳細（カテゴリ、工程名、必要データなど）
# - 新依存関係マスター: どの工程がどの工程に依存しているか
# - 設定マスター: カテゴリ設定の有無と構造
# - ガントシート: 日付が入っていない工程の調査
```

#### 2-2. カテゴリの確定
- 現在のカテゴリ: A, K, H, I, L, M, C, E, P, Z, B
- これらがどこで定義されているか（ハードコード箇所を特定）
- 設定マスターに移行できるか確認

#### 2-3. 工程名の調査
- B列（工程名）にカテゴリ名が含まれている例を洗い出し
- 例: "メイン文字起こし" → カテゴリ情報を削除して "文字起こし" にできるか

#### 2-4. 依存関係の調査
- 新依存関係マスターの構造
- どの工程がどの工程に依存しているか
- 依存元の工程が完了したら、依存先工程を「準備OK」として表示できるか

#### 2-5. 企業紹介ページの調査
- 企業データベースの構造（別スプレッドシート？）
- 既存企業・変更企業・新規企業の判別方法
- 新規作成時の作業タスク一覧

#### 2-6. フレキシブル企画の調査
- どういう企画がフレキシブルなのか
- 通常の企画との違い
- どう対応すべきか

#### 2-7. 作業アシスト機能の調査
- 文字起こし工程で使うGoogle Studioのリンク
- 使用するプロンプトの内容
- 他にアシストが必要な工程

### ステップ3: 調査結果のドキュメント化

調査結果を以下の形式でドキュメントにまとめてください：

```
docs/yumemaga-production-management/INVESTIGATION_RESULTS.md
```

内容:
- 各シートの構造（列構成、データ例）
- 依存関係の全体図
- カテゴリの定義
- ハードコード箇所のリスト
- 企業紹介ページのフロー
- 作業アシスト機能の仕様案

### ステップ4: 実装方針の提案

調査結果をもとに、実装方針をユーザーに提案してください。
**重要**: 勝手に実装を開始しないこと。必ずユーザーの承認を得てから進めてください。

---

## ⚠️ 重要な注意事項

### 絶対に守ること
1. **推測で実装しない**: 不明な点は必ずユーザーに確認する
2. **調査を最優先**: 実装前に徹底的な調査を行う
3. **ユーザーの要件を正確に理解**: IMPROVEMENT_REQUIREMENTS.mdを何度も読み直す
4. **実装前に承認を得る**: 実装方針をユーザーに提案し、OKをもらってから着手

### やってはいけないこと
- ❌ 憶測でコードを書く
- ❌ ユーザーの発言にない機能を勝手に追加する
- ❌ 調査をスキップして実装を開始する
- ❌ ハードコードを増やす

### デバッグ時の注意
- スプレッドシートの実際のデータを確認する
- エラーメッセージを正確に読む
- ブラウザのコンソールログを確認する

---

## 🔧 開発環境

```bash
# 開発サーバー起動
npm run dev

# アクセス
http://localhost:3000/dashboard/yumemaga-v2
```

**環境変数** (.env.local):
```
GOOGLE_SERVICE_ACCOUNT_KEY='...'
YUMEMAGA_SPREADSHEET_ID='1qC3cMSGv8kjt6aoK20IvbaFfD3oLfvTTrFKUU_gQXhw'
```

---

## 📚 参考ドキュメント

- `docs/yumemaga-production-management/IMPROVEMENT_REQUIREMENTS.md` - 改善要件（最重要）
- `docs/yumemaga-production-management/BACKEND_HANDOFF_2025-10-07.md` - 前回の引き継ぎ書
- `CLAUDE.md` - プロジェクト全体のガイド

---

## 💬 最後に

このプロジェクトは、ゆめマガ制作のフロー全体を理解した上で進める必要があります。
焦らず、徹底的に調査してから実装に取り掛かってください。

不明な点があれば、遠慮なくユーザーに質問してください。
推測で進めるよりも、確認して正確に進める方が結果的に早く完成します。

頑張ってください！
