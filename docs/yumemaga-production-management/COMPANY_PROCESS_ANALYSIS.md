# 企業工程の現状分析と理想的なUI/UX設計案

**作成日**: 2025-10-08
**担当**: Claude Code
**目的**: 企業工程の予実管理を実現するためのUI/UX設計

---

## 📋 目次

1. [現状の課題分析](#現状の課題分析)
2. [企業マスターとの関係](#企業マスターとの関係)
3. [予実管理として機能しない理由](#予実管理として機能しない理由)
4. [理想的なUI/UX設計案](#理想的なui/ux設計案)
5. [実装方針](#実装方針)

---

## 🔍 現状の課題分析

### 企業関連カテゴリの構成

現在、ゆめマガには**2種類の企業関連カテゴリ**があります:

| カテゴリID | カテゴリ名 | 説明 | 工程数 | 現状の問題 |
|-----------|-----------|------|--------|-----------|
| **C** | 新規企業 | 新規企業紹介ページ | 多数 | 「確認送付」「修正対応」などの抽象的な工程のみ |
| **E** | 既存企業 | 既存企業紹介ページ | 少数 | 「ページ確認」程度の簡易工程のみ |

### 現在の工程構成（推測）

#### カテゴリC（新規企業）の工程
```
C-1: 新規企業 データ提出・撮影
C-2: 新規企業 文字起こし（?）
C-3: 新規企業 内容整理
C-4: 新規企業 ページ制作
C-5: 新規企業 内部チェック
C-6: 新規企業 確認送付
C-7: 新規企業 修正対応
```

#### カテゴリE（既存企業）の工程
```
E-1: 既存企業 ページ確認
E-2: 既存企業 内部チェック
E-3: 既存企業 確認送付
E-4: 既存企業 修正対応
```

### 致命的な問題

#### ❌ 問題1: 企業ごとの進捗が見えない

現状では、「新規企業」というカテゴリで全体をまとめているため:

- **マルトモの進捗**: 不明
- **あーきぺんこの進捗**: 不明
- **テクノシンエイの進捗**: 不明

→ **どの企業が遅れているのか一目でわからない**

#### ❌ 問題2: 新規・既存・変更の区別がない

企業マスターには「初掲載号」「最終更新号」があり、以下の3パターンを判別できるはずですが、現在のシステムでは区別されていません:

1. **新規企業**: 今号が初掲載（フル制作必要）
2. **既存企業（継続）**: 前号と同じ内容（確認のみ）
3. **既存企業（変更）**: 前号から一部変更（部分制作）

→ **作業量が全く異なるのに、同じ工程で管理している**

#### ❌ 問題3: 「確認送付」「修正対応」は工程ではなくステータス

「確認送付」や「修正対応」は、独立した工程ではなく、**各工程のステータス**として扱うべきです。

現状:
```
C-6: 新規企業 確認送付
C-7: 新規企業 修正対応
```

あるべき姿:
```
C-4: 新規企業 ページ制作
  ├─ 制作中
  ├─ 内部チェック
  ├─ 確認送付（ステータス）
  ├─ 修正対応（ステータス）
  └─ 確認OK
```

→ **予実管理として機能しない根本原因**

---

## 🏢 企業マスターとの関係

### 企業マスターの構造

企業マスターには**6社**のデータがあり、各企業には以下のメタ情報があります:

| 列 | 項目 | 説明 | 使用例 |
|----|------|------|--------|
| 48 | 初掲載号 | 初めて掲載された号 | `2024年10月号` |
| 49 | 最終更新号 | 最後に更新された号 | `2025年11月号` |
| 50 | ステータス | 企業の状態 | `active` / `inactive` |
| 51 | 備考 | メモ | `✅ 実データ反映済み` |

### 新規・既存・変更の判定ロジック

```typescript
function getCompanyStatus(company: Company, currentIssue: string): 'new' | 'existing' | 'updated' | 'none' {
  if (company.firstIssue === currentIssue) {
    return 'new'; // 新規企業（フル制作）
  }

  if (company.lastIssue === currentIssue) {
    // 前号と比較して変更があるか確認
    const previousIssue = getPreviousIssue(currentIssue);
    if (company.lastIssue === previousIssue) {
      return 'existing'; // 既存企業（継続）
    } else {
      return 'updated'; // 既存企業（変更）
    }
  }

  return 'none'; // この号には掲載されない
}
```

### 企業別の工程テンプレート

| 企業ステータス | 必要な工程 | 工数 |
|--------------|-----------|------|
| **新規企業** | ヒアリング → 撮影 → 文字起こし → 内容整理 → ページ制作 → 確認 | 大 |
| **既存企業（変更）** | 変更箇所確認 → 撮影（必要に応じて） → ページ更新 → 確認 | 中 |
| **既存企業（継続）** | ページ確認のみ | 小 |

---

## ❌ 予実管理として機能しない理由

### 理由1: 企業を横断した集計になっている

現在のカテゴリC（新規企業）は、**全企業の進捗を合算**しています:

```
カテゴリC: 新規企業
├─ C-1: データ提出 (完了: 2/6社)
├─ C-2: 文字起こし (完了: 1/6社)
└─ C-3: ページ制作 (完了: 0/6社)
```

これでは:
- ❌ **どの企業が遅れているか**がわからない
- ❌ **予定日との差**が見えない
- ❌ **ボトルネック**が特定できない

### 理由2: 「確認送付」「修正対応」が独立工程になっている

現在:
```
C-6: 確認送付 (予定: 10/20)
C-7: 修正対応 (予定: 10/22)
```

これでは:
- ❌ **何の確認**をしているのかわからない
- ❌ **修正完了の基準**が不明確
- ❌ **予実の差分**が測れない

### 理由3: 予定日が工程別になっている

現在:
```
C-4: ページ制作 (予定: 10/15) ← 全企業共通
```

実際の予実管理では:
```
マルトモ: ページ制作 (予定: 10/12, 実績: 10/13) → 1日遅延
あーきぺんこ: ページ制作 (予定: 10/14, 実績: -) → 未完了
テクノシンエイ: ページ制作 (予定: 10/16, 実績: 10/15) → 1日前倒し
```

→ **企業ごとの予実管理が必須**

---

## ✨ 理想的なUI/UX設計案

### コンセプト

> **企業を軸にした予実管理 + ステータスベースの進捗追跡**

### 設計案A: 企業別カードビュー（推奨）

#### レイアウト

```
┌─────────────────────────────────────────┐
│ 📋 企業紹介ページ管理                    │
│                                         │
│ 今月号掲載企業: 6社（新規3社・変更2社・継続1社）│
└─────────────────────────────────────────┘

┌──────────────────────┐ ┌──────────────────────┐
│ 🏢 マルトモ [新規]    │ │ 🏢 あーきぺんこ [新規] │
│                      │ │                      │
│ 進捗: 45% (5/11工程) │ │ 進捗: 80% (8/10工程) │
│ 予定: 10/22         │ │ 予定: 10/20         │
│ ステータス: 内部チェック │ │ ステータス: 確認送付中 │
│                      │ │                      │
│ ◆ ヒアリング [完了]   │ │ ◆ ヒアリング [完了]   │
│    予: 9/20 実: 9/20 │ │    予: 9/18 実: 9/18 │
│                      │ │                      │
│ ◆ 撮影 [完了]        │ │ ◆ 撮影 [完了]        │
│    予: 9/25 実: 9/26 │ │    予: 9/22 実: 9/21 │
│    ⚠️ 1日遅延        │ │    ✅ 1日前倒し       │
│                      │ │                      │
│ ◆ 文字起こし [完了]   │ │ ◆ 文字起こし [完了]   │
│    予: 9/27 実: 9/28 │ │    予: 9/24 実: 9/23 │
│                      │ │                      │
│ ◆ 内容整理 [進行中]   │ │ ◆ ページ制作 [確認送付中]│
│    予: 10/1 実: -    │ │    予: 10/15 実: 10/14│
│    🔵 準備OK         │ │    📤 確認送付（10/19）│
│    [完了ボタン]      │ │    └─ 修正依頼（0件）  │
│                      │ │    [確認OK] [要修正]  │
│ ◆ ページ制作 [未着手] │ │                      │
│    予: 10/10 実: -   │ │ ◆ 最終確認 [未着手]   │
│    ⏸️ 依存: 内容整理  │ │    予: 10/20 実: -   │
│                      │ │                      │
│ [詳細を見る]         │ │ [詳細を見る]         │
└──────────────────────┘ └──────────────────────┘

┌──────────────────────┐ ┌──────────────────────┐
│ 🏢 テクノシンエイ [変更]│ │ 🏢 稲垣製作所 [継続]  │
│                      │ │                      │
│ 進捗: 60% (3/5工程)  │ │ 進捗: 100% (1/1工程) │
│ 予定: 10/18         │ │ 予定: 10/5          │
│ ステータス: 制作中    │ │ ステータス: ✅完了    │
│                      │ │                      │
│ ◆ 変更箇所確認 [完了] │ │ ◆ ページ確認 [完了]   │
│    予: 9/30 実: 9/29 │ │    予: 10/3 実: 10/2 │
│                      │ │                      │
│ ◆ 追加撮影 [完了]    │ │ [詳細を見る]         │
│    予: 10/5 実: 10/6 │ │                      │
│    ⚠️ 1日遅延        │ └──────────────────────┘
│                      │
│ ◆ ページ更新 [進行中] │
│    予: 10/12 実: -   │
│    🔵 準備OK         │
│    [完了ボタン]      │
│                      │
│ [詳細を見る]         │
└──────────────────────┘
```

#### 特徴

1. **企業ごとにカード分離**
   - 一目でどの企業が遅れているかわかる
   - 企業のステータス（新規・変更・継続）が明確

2. **ステータスベースの進捗表示**
   - 「確認送付中」「内部チェック」などのステータスをカードに表示
   - 確認依頼・修正対応の履歴も表示

3. **予実管理の可視化**
   - 予定日と実績日を並べて表示
   - 遅延日数・前倒し日数を色分けで強調

4. **準備OK判定**
   - 依存工程が完了した工程に「🔵 準備OK」バッジ
   - 遅延工程に「⚠️ X日遅延」バッジ

---

### 設計案B: 企業別タブビュー

```
┌─────────────────────────────────────────┐
│ 📋 企業紹介ページ管理                    │
│                                         │
│ [マルトモ 45%] [あーきぺんこ 80%] [テクノシンエイ 60%] ...│
└─────────────────────────────────────────┘

┌─── 現在選択: マルトモ（新規企業） ─────┐
│                                         │
│ 進捗: 45% (5/11工程完了)                │
│ 全体予定: 9/20 〜 10/22                 │
│ 現在のステータス: 内部チェック           │
│                                         │
│ ┌───────────────────────────────────┐ │
│ │ ◆ ヒアリング                        │ │
│ │   予定: 9/20  実績: 9/20  [完了]    │ │
│ ├───────────────────────────────────┤ │
│ │ ◆ 撮影                              │ │
│ │   予定: 9/25  実績: 9/26  [完了]    │ │
│ │   ⚠️ 1日遅延                        │ │
│ ├───────────────────────────────────┤ │
│ │ ◆ 文字起こし                        │ │
│ │   予定: 9/27  実績: 9/28  [完了]    │ │
│ ├───────────────────────────────────┤ │
│ │ ◆ 内容整理                          │ │
│ │   予定: 10/1  実績: -    [進行中]   │ │
│ │   🔵 準備OK  [完了ボタン]           │ │
│ ├───────────────────────────────────┤ │
│ │ ◆ ページ制作                        │ │
│ │   予定: 10/10  実績: -   [未着手]   │ │
│ │   ⏸️ 依存: 内容整理                 │ │
│ └───────────────────────────────────┘ │
│                                         │
│ [確認履歴を見る] [企業情報を編集]       │
└─────────────────────────────────────┘
```

---

### 設計案C: ガントチャート統合ビュー

```
┌─────────────────────────────────────────┐
│ 📋 企業紹介ページ管理（ガントチャート）   │
└─────────────────────────────────────────┘

企業名         | 9/20  9/25  9/30  10/5  10/10 10/15 10/20
─────────────────────────────────────────────────────────
マルトモ [新規]  ████████████████▓▓▓▓▓▓░░░░░░░░░░ 45%
                  ↑      ↑     ↑    ▲
                  ヒア   撮影  文字   現在（内容整理中）

あーきぺんこ[新規] ████████████████████████████▓▓░░ 80%
                  ↑      ↑     ↑       ↑     ▲
                  ヒア   撮影  文字   ページ  現在（確認送付中）

テクノシンエイ[変更] ██████████████▓▓▓▓░░░░░░░░░░ 60%
                    ↑      ↑    ▲
                    変更確認 撮影 現在（ページ更新中）

凡例: ████ 完了  ▓▓▓▓ 進行中  ░░░░ 未着手  ⚠️ 遅延
```

---

## 🎯 推奨設計: 案A（企業別カードビュー）

### 理由

1. **一覧性が高い**
   - 6社の進捗を一目で比較できる
   - ボトルネックを即座に発見できる

2. **予実管理に最適**
   - 予定日と実績日を並べて表示
   - 遅延・前倒しが色分けで一目瞭然

3. **ステータス管理が明確**
   - 「確認送付中」「内部チェック」などの状態が明確
   - 修正依頼の件数も表示

4. **スケーラビリティ**
   - 企業数が増えても対応可能
   - フィルタリング機能で絞り込み可能

---

## 🛠️ 実装方針

### Phase 1: データ構造の整理

#### 1-1. 企業マスターとの連携API作成

```typescript
// /app/api/yumemaga-v2/companies/route.ts
export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const issue = searchParams.get('issue'); // 2025年11月号

  // 企業マスター取得
  const companies = await getCompanyMaster();

  // 今号の掲載企業のみフィルタ
  const featuredCompanies = companies.filter(company => {
    return isCompanyFeaturedInIssue(company, issue);
  });

  // 新規・変更・継続を判定
  const companiesWithStatus = featuredCompanies.map(company => ({
    ...company,
    status: getCompanyStatus(company, issue), // 'new' | 'updated' | 'existing'
    processes: getProcessesForCompany(company, issue),
  }));

  return NextResponse.json({
    success: true,
    companies: companiesWithStatus,
  });
}
```

#### 1-2. 企業別工程マスターの作成

スプレッドシートに新規シート「企業別工程マスター」を追加:

| 企業ステータス | 工程No | 工程名 | 必要データ | 標準所要日数 |
|--------------|--------|--------|-----------|------------|
| new | C-NEW-1 | ヒアリング | - | 1日 |
| new | C-NEW-2 | 撮影 | 写真データ | 1日 |
| new | C-NEW-3 | 文字起こし | 録音データ | 2日 |
| new | C-NEW-4 | 内容整理 | - | 3日 |
| new | C-NEW-5 | ページ制作 | 全データ | 5日 |
| updated | C-UPD-1 | 変更箇所確認 | 情報シート | 1日 |
| updated | C-UPD-2 | 追加撮影（任意） | 写真データ | 1日 |
| updated | C-UPD-3 | ページ更新 | - | 2日 |
| existing | C-EXT-1 | ページ確認 | - | 1日 |

### Phase 2: UI実装

#### 2-1. 企業カードコンポーネント作成

```typescript
// components/company-management/CompanyCard.tsx
interface CompanyCardProps {
  company: Company;
  processes: Process[];
  onUpdateActualDate: (companyId: string, processNo: string, date: string) => void;
  onUpdateConfirmationStatus: (companyId: string, status: string) => void;
}

export function CompanyCard({ company, processes, ... }: CompanyCardProps) {
  // カード内に企業情報・進捗・工程リスト・ステータスを表示
}
```

#### 2-2. 企業管理セクション作成

```typescript
// components/company-management/CompanyManagementSection.tsx
export function CompanyManagementSection({
  companies,
  onUpdateActualDate,
  onUpdateConfirmationStatus,
}: CompanyManagementSectionProps) {
  return (
    <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
      {companies.map(company => (
        <CompanyCard
          key={company.companyId}
          company={company}
          processes={getProcessesForCompany(company)}
          onUpdateActualDate={onUpdateActualDate}
          onUpdateConfirmationStatus={onUpdateConfirmationStatus}
        />
      ))}
    </div>
  );
}
```

### Phase 3: ステータス管理

#### 3-1. 確認送付・修正対応をステータスとして扱う

```typescript
interface ProcessWithStatus extends Process {
  confirmationStatus: 'not_sent' | 'pending' | 'approved' | 'revision_requested';
  revisionHistory: Revision[];
}

interface Revision {
  requestedAt: string;
  requestedBy: string;
  comments: string;
  resolvedAt?: string;
}
```

#### 3-2. ステータス遷移ロジック

```
制作中 → 内部チェック → 確認送付 → (確認OK | 要修正)
                                      ↓
                                  修正対応 ─→ 確認送付
```

### Phase 4: 予実管理機能

#### 4-1. 予定日の自動算出

```typescript
function calculatePlannedDates(company: Company, issue: string) {
  const publishDate = getPublishDate(issue); // 発行日
  const companyStatus = getCompanyStatus(company, issue);
  const processes = getProcessTemplates(companyStatus);

  let currentDate = publishDate;
  const plannedDates = [];

  // 逆算スケジュール
  for (let i = processes.length - 1; i >= 0; i--) {
    const process = processes[i];
    currentDate = subtractDays(currentDate, process.standardDuration);
    plannedDates.unshift({
      processNo: process.processNo,
      plannedDate: currentDate,
    });
  }

  return plannedDates;
}
```

#### 4-2. 遅延・前倒しの可視化

```typescript
function getScheduleVariance(plannedDate: string, actualDate: string) {
  const planned = new Date(plannedDate);
  const actual = new Date(actualDate);
  const diff = Math.floor((actual - planned) / (1000 * 60 * 60 * 24));

  if (diff > 0) {
    return { type: 'delayed', days: diff };
  } else if (diff < 0) {
    return { type: 'ahead', days: Math.abs(diff) };
  } else {
    return { type: 'on_schedule', days: 0 };
  }
}
```

---

## 📊 期待される効果

### Before（現状）
- ❌ どの企業が遅れているかわからない
- ❌ 予実の差分が見えない
- ❌ 確認送付・修正対応が工程として扱われている
- ❌ 新規・変更・継続の区別がない

### After（改善後）
- ✅ 企業ごとの進捗が一目瞭然
- ✅ 予定日と実績日の差分が可視化される
- ✅ ステータスベースの管理で柔軟な運用が可能
- ✅ 企業ステータスに応じた工程テンプレートで効率化

---

## ✅ 成功基準

1. **企業ごとの進捗が可視化される**
   - [ ] 6社すべての進捗率が表示される
   - [ ] 遅延している企業が一目でわかる

2. **予実管理が機能する**
   - [ ] 予定日と実績日が並べて表示される
   - [ ] 遅延日数・前倒し日数が計算される

3. **ステータス管理が明確**
   - [ ] 「確認送付中」「内部チェック」などのステータスが表示される
   - [ ] 修正依頼の件数が表示される

4. **企業ステータスの判別**
   - [ ] 新規・変更・継続が自動判別される
   - [ ] 各ステータスに応じた工程テンプレートが適用される

---

## 📝 次のステップ

1. **ユーザーフィードバックの取得**
   - 案A/B/Cのどれが最適か確認
   - 必要な情報が不足していないか確認

2. **実装優先度の決定**
   - Phase 1（データ構造）→ Phase 2（UI）→ Phase 3（ステータス）→ Phase 4（予実管理）

3. **プロトタイプの作成**
   - モックデータで動作確認
   - UIの調整

---

**作成者**: Claude Code
**最終更新**: 2025-10-08
**次回更新**: ユーザーフィードバック反映後
