# ゆめマガ制作進捗管理システム 要件定義書

**作成日**: 2025-10-07
**バージョン**: 2.0
**ステータス**: UI実装完了、バックエンド未実装

---

## 🎯 目的

**ゆめマガ制作進捗管理システム**は、雑誌制作の97工程を効率的に管理し、発行日から逆算したスケジュール生成、予実管理、ファイル管理を一元化するダッシュボードです。

### 課題
- 現状: Google Spreadsheetsで高度な逆算スケジューラーを運用中
- 問題点: スプレッドシートは表示のみ、データ入力・管理が煩雑
- 解決策: ダッシュボードで計算・入力・管理を完結させ、スプレッドシートは同期先として使用

---

## 📊 システム概要

### コアコンセプト

```
【現状】
Google Sheets（計算） → ダッシュボード（表示のみ）

【目標】
ダッシュボード（計算・入力・管理） ⇄ Google Sheets（同期）
                                    ⇄ Google Drive（ファイル管理）
```

### 主要機能

1. **発行日逆算スケジュール生成**
   - 発行日を入力 → 60日間の逆算ガントチャートを自動生成
   - マスターデータ（依存関係、カテゴリ同期、負荷制約）を適用

2. **カテゴリ別予実管理**
   - A、K、H などカテゴリごとに進捗を可視化
   - 工程100%完了 + 先方確認OK = カテゴリ完了

3. **先方確認ステータス管理**
   - 各カテゴリの確認送付・確認待ち・確認OKを管理
   - カテゴリZ（全体進捗）は各カテゴリの集約のみ

4. **データ提出進捗管理**
   - 録音データ、文字起こし、写真画像の提出状況を追跡
   - 〆切期限超過をアラート表示

5. **Google Drive連携**
   - カテゴリごとにフォルダ自動作成
   - ダッシュボードから直接ファイルアップロード

6. **Canva連携**
   - カテゴリごとにCanvaページURLを登録
   - 未登録の場合はメインページ（月号）へ遷移

---

## 🖥️ UI/UX設計

### 画面構成

```
┌─────────────────────────────────────────────────────┐
│ [← トップへ] ゆめマガ制作進捗管理 v2.0                │
├─────────────────────────────────────────────────────┤
│ 📅 新規号作成 / 月号選択                             │
│ ┌───────────────────────────────────────┐          │
│ │ 発行日: [2025/11/08] [逆算実行]     │          │
│ │ 既存の号: [2025年11月号 ▼] [読み込み]│         │
│ └───────────────────────────────────────┘          │
├─────────────────────────────────────────────────────┤
│ 📊 進捗サマリー                                      │
│ ┌─────┬─────┬─────┬─────┐                         │
│ │完了  │進行中│未着手│遅延  │                         │
│ │ 45  │  12  │  23  │  3   │                         │
│ └─────┴─────┴─────┴─────┘                         │
├─────────────────────────────────────────────────────┤
│ 📋 カテゴリ別予実管理                                │
│ ┌───────────────────────┐ ┌───────────────────┐   │
│ │カテゴリA: メイン記事 60%│ │カテゴリK: インタ②25%│  │
│ │━━━━━━━━━░            │ │━━━░░░░░░░       │   │
│ │3/5工程完了            │ │1/4工程完了       │   │
│ │[Drive] [Canva]        │ │[Drive] [Canva]   │   │
│ │                       │ │                  │   │
│ │📋 先方確認: ⏳確認待ち │ │📋 先方確認: 未送付│  │
│ │[未送付/確認待ち/OK▼] │ │[未送付/確認待ち/OK▼]│ │
│ │[工程詳細を開く▼]      │ │[工程詳細を開く▼] │   │
│ └───────────────────────┘ └───────────────────┘   │
│                                                     │
│ ┌───────────────────────────────────────┐          │
│ │カテゴリZ: 全体進捗               62% │          │
│ │━━━━━━━░░░                           │          │
│ │1/3カテゴリ完全完了                   │          │
│ │                                      │          │
│ │各カテゴリの状況:                     │          │
│ │⚠️ A: メイン記事 60%                  │          │
│ │⚠️ K: インタビュー② 25%              │          │
│ │✅ H: STAR① 100% (確認OK)            │          │
│ │                                      │          │
│ │※Zは集約のみ。独自の確認送付なし     │          │
│ └───────────────────────────────────────┘          │
├─────────────────────────────────────────────────────┤
│ 📁 データ提出進捗管理                                │
│ ┌───────────────────────────────────────┐          │
│ │カテゴリ: [A ▼] [ファイル選択/D&D]   │          │
│ └───────────────────────────────────────┘          │
│                                                     │
│ ┌───────────────────┐ ┌───────────────────┐      │
│ │カテゴリA: メイン記事│ │カテゴリK: インタ②│      │
│ │⚠️ 期限超過あり      │ │⚠️ 期限超過あり    │      │
│ │                    │ │                  │      │
│ │✅ 録音データ 提出済み│ │⚠️ 録音データ 未提出│     │
│ │⚠️ 文字起こし 未提出 │ │－ 文字起こし(任意)│     │
│ │✅ 写真画像 提出済み  │ │✅ 写真画像 提出済み│     │
│ │                    │ │                  │      │
│ │〆切: 9/28          │ │〆切: 9/28        │      │
│ └───────────────────┘ └───────────────────┘      │
├─────────────────────────────────────────────────────┤
│ 📊 ガントチャート（全期間）                          │
│ （横スクロール対応、本日ハイライト）                 │
└─────────────────────────────────────────────────────┘
```

---

## 🔧 機能要件

### 1. 新規号作成フロー

**入力**:
- 発行日（例: 2025-11-08）

**処理**:
1. マスターデータ読み込み
   - 新工程マスター（全工程の基本情報）
   - 新依存関係マスター（工程間の順序制約）
   - カテゴリ同期マスター（同時実行ルール）
   - 負荷制約マスター（担当者の負荷制限）
   - カレンダーマスター（営業日情報）

2. 逆算計算
   - 発行日から60日前まで逆算
   - 依存関係を辿って各工程の実施日を決定
   - カテゴリ同期ルールを適用
   - 負荷制約をチェック
   - 休日を回避

3. スプレッドシートに保存
   - 新しいガントシート作成（例: `逆算配置_ガント_2025年11月号`）
   - 各工程の実施日をセルに記録
   - 配置理由を記録

**出力**:
- ガントチャート表示
- 工程一覧表示
- 「2025年11月号を作成しました」メッセージ

### 2. 予実管理フロー

**カテゴリカード表示**:
- 進捗率（工程完了数 / 総工程数）
- 完了工程数 / 総工程数
- Drive / Canvaボタン
- 先方確認ステータス（3段階）
- 工程詳細展開ボタン

**工程詳細（展開時）**:
- 工程ID、工程名、予定日、ステータス
- 実績日入力フィールド（直接入力可能）

**一括保存**:
- 全カテゴリの実績日をスプレッドシートに書き込み
- 進捗入力シートを更新

### 3. 先方確認管理フロー

**ステータス**:
- `未送付`: 初期状態
- `確認待ち`: 確認送付済み、返答待ち
- `確認OK`: 先方承認済み、カテゴリ完了

**カテゴリ完了条件**:
```
工程進捗100% AND 先方確認OK = カテゴリ完了
```

**カテゴリZ（全体進捗）**:
```
全体進捗率 = Σ(各カテゴリの進捗率) / カテゴリ数
完全完了数 = 工程100% AND 確認OK のカテゴリ数
```

### 4. データ提出管理フロー

**必要データ**:
- 録音データ（必須）
- 文字起こし（任意）
- 写真画像（必須）

**ステータス**:
- `submitted`: 提出済み ✅
- `pending`: 未提出 ⚠️
- `none`: 任意データで未提出 －

**アラート条件**:
```
必須データ AND status === 'pending' = 期限超過アラート（赤表示）
```

### 5. Google Drive連携フロー

**フォルダ構造**:
```
/ゆめマガ/
  └ 2025年11月号/
      ├ カテゴリA/
      │   ├ 録音データ/
      │   ├ 文字起こし/
      │   └ 写真画像/
      ├ カテゴリK/
      └ ...
```

**アップロード**:
1. カテゴリ選択
2. ファイル選択 or D&D
3. Google Drive APIでアップロード
4. スプレッドシートのステータスを`submitted`に更新

### 6. Canva連携フロー

**登録あり**:
```
[Canva] ボタンクリック → 登録URLへ遷移
```

**登録なし**:
```
[Canva] ボタンクリック → メインページ「2025年11月号」へ遷移
```

---

## 📈 非機能要件

### パフォーマンス
- ガントチャート生成: 3秒以内
- データ保存: 1秒以内
- ファイルアップロード: 10MB以下を3秒以内

### セキュリティ
- MVP: 認証なし（VPC内運用）
- Phase2: Google OAuth認証

### 可用性
- MVP: 手動リフレッシュのみ
- Phase2: 自動ポーリング（30秒間隔）

---

## 🚧 制約事項

### MVPスコープ
- ❌ スプレッドシートへの書き込み（Phase2で実装）
- ❌ 自動リフレッシュ（Phase2で実装）
- ❌ 認証システム（Phase2で実装）
- ✅ 読み取り専用表示
- ✅ モックデータでのUI確認
- ✅ 基本的な操作フロー確認

### スプレッドシート制約
- 既存シートは**絶対に改変しない**
- テスト用シートを別途作成
- 読み取り専用として扱う

---

## 🔄 開発ロードマップ

### Phase 1: UI実装（完了）
- [x] 完成版ダッシュボードUI作成
- [x] カテゴリ別予実管理UI
- [x] 先方確認ステータス管理UI
- [x] データ提出進捗管理UI
- [x] カテゴリZの全体進捗表示

### Phase 2: バックエンド実装（未完了）
- [ ] 逆算スケジュール生成ロジック
- [ ] スプレッドシート読み書きAPI
- [ ] Google Drive連携API
- [ ] Canva URL管理機能

### Phase 3: 追加機能（未完了）
- [ ] 次月事前準備項目
- [ ] 各工程での細かい作業アシスト
- [ ] ガントチャート全期間表示

### Phase 4: 統合・テスト（未完了）
- [ ] 実データでのテスト
- [ ] パフォーマンス最適化
- [ ] ユーザーフィードバック反映

---

## 📝 用語集

| 用語 | 説明 |
|-----|------|
| **カテゴリ** | 工程のグループ（A: メイン記事、K: インタビュー②など） |
| **カテゴリZ** | 全カテゴリの進捗を集約する特別なカテゴリ |
| **先方確認** | クライアントへの確認送付・承認プロセス |
| **逆算スケジュール** | 発行日から逆算して各工程の実施日を計算 |
| **Phase4逆算スケジューラー** | スプレッドシート上の既存システム |
| **マスターデータ** | 工程の依存関係・制約・同期ルールを定義したデータ |

---

**最終更新**: 2025-10-07
**次のアクション**: Phase 2のバックエンド実装開始
