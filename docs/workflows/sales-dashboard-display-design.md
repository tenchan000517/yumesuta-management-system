# 営業ダッシュボード表示設計タスク

## 目的
営業進捗データをTOPページと営業管理ダッシュボード（/dashboard/sales）でどのように表示するかを設計・実装する。

## 現状

### 利用可能なデータ（/api/sales-kpi）

#### 1. 月次予実管理
- 契約件数: 目標5件、実績0件、過不足-5件
- 売上: 目標¥400,000、実績¥0、過不足-¥400,000
- 入金: 目標¥0、実績¥0、未入金¥0

#### 2. 顧客マスタ集計
- 今週の商談予定: 5件
- 報告待ち: 2件
- ステータス別件数:
  - 初回商談待ち: 15件
  - 返事待ち: 1件
  - 商談中: 1件

#### 3. KPIダッシュボード
- 営業日進捗率: 17.4% (4/23日経過)
- 行動量メトリクス（月次目標・今日時点で必要・実績・過不足・ステータス）:
  - テレアポ: 目標92件、実績23件、過不足+7件
  - アポ: 目標46件、実績10件、過不足+2件
  - 商談: 目標32件、実績0件、過不足-6件
  - クロージング: 目標25件、実績0件、過不足-5件
  - 成約: 目標5件、実績0件、過不足-1件
- 転換率: アポ取得率43.5%（想定50%、-6.5%）
- ゆめマガ配布状況:
  - 配布可能校: 目標50校、実績4校
  - 配布済校: 目標4校、実績0校
  - 配布部数: 目標1,000部、実績0部

## 実装済み内容

### API実装
- **ファイル**: `app/api/sales-kpi/route.ts`
- **取得シート**:
  - KPIダッシュボード（日次進捗）
  - 月次予実管理（月次目標・実績）
  - 顧客マスタ（商談予定、ステータス別集計）
- **型定義**: `types/sales.ts` に `MonthlyPerformance`, `CustomerMasterStats` を追加済み

### 顧客マスタ集計ロジック
- ネクスト日（Q列）のパース: "10/9"、"10月9日" 形式に対応
- 年判定: 1ヶ月以上過去の場合は来年扱い
- 今週の範囲: 月曜〜日曜で判定
- 報告待ち: 過去1ヶ月以内の日付
- ステータス列（R列）: 直接取得して集計

## 未実装・検討が必要な内容

### 1. TOPページ営業進捗カードの表示項目
**現在のコード位置**: `app/page.tsx:141-158`

**現在の表示**（間違った内容）:
- 今月の成約件数
- 今月の売上
- 進行中の商談

**表示すべき項目を決定してください**:
- [ ] 契約件数達成状況（例: 0/5件、0%）
- [ ] 売上達成状況（例: ¥0/¥400,000、0%）
- [ ] 未入金額
- [ ] 今週の商談予定
- [ ] 報告待ち件数
- [ ] ステータス別件数
- [ ] 営業日進捗率
- [ ] その他

**制約**: カードに表示できるのは3-4項目程度

### 2. 営業管理ダッシュボード（/dashboard/sales）の表示設計
**現在のコード位置**: `app/dashboard/sales/page.tsx`

**現在の表示**: KPIダッシュボードの内容のみ

**追加すべきセクション**:
- [ ] 月次予実サマリー
- [ ] 顧客マスタ集計（今週の予定、報告待ち、ステータス別）
- [ ] 行動量メトリクス詳細
- [ ] 転換率
- [ ] ゆめマガ配布状況

**各セクションのレイアウト・表示形式を設計してください**

## タスク

### Phase 1: 表示設計
1. TOPページ営業進捗カードに表示する項目を決定（3-4項目）
2. 営業管理ダッシュボードのレイアウトを設計
   - どのセクションをどの順序で配置するか
   - 各セクションでどのデータをどう表示するか（表、グラフ、カードなど）

### Phase 2: 実装
3. TOPページ `app/page.tsx` の営業進捗カード表示を修正
   - APIレスポンスから必要なデータを抽出
   - summary オブジェクトを構築
   - DashboardCard コンポーネントに渡す
4. 営業管理ダッシュボード `app/dashboard/sales/page.tsx` を拡張
   - 月次予実セクションを追加
   - 顧客マスタ集計セクションを追加
   - 既存のKPIダッシュボード表示を改善

### Phase 3: 検証
5. 実際のデータで表示を確認
6. マネージャー視点で必要な情報が揃っているか検証
7. UIの改善（必要に応じて）

## 参考情報

### DashboardCard コンポーネントの仕様
```typescript
<DashboardCard
  title="カードタイトル"
  href="/dashboard/xxx"
  icon={IconComponent}
  summary={[
    { label: 'ラベル1', value: '値1' },
    { label: 'ラベル2', value: '値2' },
    { label: 'ラベル3', value: '値3' },
  ]}
  lastUpdated={updatedAt}
/>
```

### 既存のダッシュボードページ参考
- `/app/dashboard/process/page.tsx` - ゆめマガ制作ダッシュボード
- `/app/dashboard/partners/page.tsx` - パートナー・スターダッシュボード

## 次のアクション
1. このドキュメントを読む
2. TOPページと営業ダッシュボードの表示設計を提案する
3. ユーザーの承認を得る
4. 実装を開始する
