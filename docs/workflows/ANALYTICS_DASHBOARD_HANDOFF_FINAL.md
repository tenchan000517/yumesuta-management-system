# アナリティクスダッシュボード 最終引き継ぎドキュメント

**作成日**: 2025-10-06
**重要度**: ★★★★★（最高）
**ステータス**: UI改善完了、データ精度の調査・改善が必要
**次世代担当者へ**: このドキュメントを最初から最後まで読んでから作業を開始してください

---

## 🎯 このセッションで何をしたか

### ✅ 完了した作業

1. **UI改善3タスク完了**
   - 重要キーワード順位表示（メダル、トレンド矢印、色分け）
   - 一般ワード vs ブランドワード流入比率（2色プログレスバー）
   - KGI/KPI表示の視覚化（達成率別色分け、アラート）

2. **データ整合性の問題を発見**
   - ブランドワード定義に「ゆめマガ」が抜けていた → 修正済み
   - キーワード順位表示のロジック改善（検索されていない vs SEO力不足を区別）

### ⚠️ 未完了・要調査の重要な問題

**重要**: 以下の問題は**調査が必要**です。現時点では改善できていません。

---

## 🔴 【最優先】データ精度の問題

### 問題1: キーワード順位データの信頼性

**現象:**
- 「ゆめマガ」で実際に検索すると1位に表示される
- しかし、ダッシュボードでは「ランク外（999位）」と表示
- 表示理由: 過去30日間で「ゆめマガ」というキーワードで**誰も検索していない**

**原因:**
```typescript
// lib/search-console.ts:204
operator: 'equals',  // 完全一致検索
expression: keyword, // 例: 'ゆめマガ'
```

Search Console APIは「実際に検索されたクエリ」のデータしか返しません。
- 誰も検索していない = データなし = 999位と表示

**マネージャー視点での問題:**
- 「SEO力が足りないのか？」
- 「そもそも検索されていないのか？」

この2つは**改善施策が全く異なる**のに、現在の表示では区別できません。

**暫定対応（このセッションで実装済み）:**
```typescript
// app/dashboard/analytics/page.tsx:523-527
{kw.position === 999 && kw.impressions === 0 ? (
  <span className="text-blue-600 font-medium">💡 検索されていません</span>
) : kw.position > 50 ? (
  <span className="text-red-600 font-medium">⚠️ SEO対策必要</span>
) : null}
```

**次世代担当者への指示:**

以下の調査を実施してください：

1. **Search Console の実際のデータを確認**
   ```
   Google Search Console → 検索パフォーマンス
   → クエリフィルター: 「ゆめマガ」を含む
   → 過去30日間のデータを確認
   ```

2. **判明する可能性:**
   - A. 本当に誰も検索していない → 認知度向上施策が必要
   - B. 「ゆめマガ とは」などの複合キーワードで検索されている → `operator: 'contains'` に変更すべき
   - C. 別のキーワードで検索されている → キーワード定義を見直すべき

3. **改善方針の決定:**
   - 上記A/B/Cのどれかによって、実装方針が変わります
   - **ユーザー（マネージャー）に確認**: 「完全一致のみを追跡したいのか？」「部分一致も含めたいのか？」

---

### 問題2: ブランドワード vs 一般ワードの整合性

**現象:**
```
流入元キーワード分析: 44クリック
├ ブランドワード: 44クリック (100%)
└ 一般ワード: 0クリック (0%)

重要キーワード順位:
├ ゆめスタ: 36クリック
└ その他: 8クリック（どこ？）
```

**原因:**
- **ブランドワード流入比率**: Search Console Top Queries全体から集計
  - 「ゆめスタ」を含むすべてのクエリの合計
  - 例: 「ゆめスタ」「ゆめスタ 愛知」「ゆめスタ 求人」など
- **重要キーワード順位**: 個別キーワードの正確なデータ
  - 「ゆめスタ」という完全一致のみ: 36クリック

**次世代担当者への指示:**

1. **Search Console でTop Queries を確認**
   ```
   Google Search Console → 検索パフォーマンス
   → クエリタブ → 並び替え: クリック数（降順）
   → 上位10件を確認
   ```

2. **判明すべきこと:**
   - 44クリックの内訳は何か？
   - 「ゆめスタ 〇〇」のような複合キーワードがどれくらいあるか？

3. **改善方針:**
   - 必要であれば、ブランドワード判定ロジックを調整
   - または、重要キーワード順位の取得方法を `operator: 'contains'` に変更

---

## 📊 現在の実装状況

### ファイル構成

```
app/
├── api/analytics/route.ts          # API実装
│   ├── calculateBrandKeywordRatio() # ブランドワード判定（27-55行目）
│   └── KPI計算ロジック              # 226-297行目
├── dashboard/analytics/page.tsx     # UI実装
│   ├── KGI/KPIカード                # 138-340行目
│   ├── ブランドワード比率           # 344-459行目
│   └── 重要キーワード順位           # 460-536行目

lib/
├── google-analytics.ts              # GA4連携
│   └── getConversionEvents()        # お問い合わせ数取得（315-360行目）
├── search-console.ts                # Search Console連携
│   ├── IMPORTANT_KEYWORDS           # 重要キーワード定義（146-155行目）
│   └── getImportantKeywordRankings()# 順位取得（170-299行目）

types/
└── analytics.ts                     # 型定義
    └── KeywordRanking               # 46-57行目
```

### 重要な設定

**ブランドワード定義（app/api/analytics/route.ts:27-30）:**
```typescript
const brandKeywords = [
  'ゆめスタ', 'ゆめすた', 'ユメスタ', '夢スタ', 'yumesuta',
  'ゆめマガ', 'ゆめまが', 'ユメマガ', '夢マガ', 'yumemaga'
];
```

**重要キーワード定義（lib/search-console.ts:146-155）:**
```typescript
export const IMPORTANT_KEYWORDS = [
  { keyword: 'ゆめスタ', priority: 'high', targetPosition: 1 },
  { keyword: 'ゆめマガ', priority: 'high', targetPosition: 5 },
  { keyword: '高校生 就職 愛知', priority: 'high', targetPosition: 10 },
  { keyword: '高校生 就活 情報誌', priority: 'medium', targetPosition: 15 },
  { keyword: '高卒採用 三重', priority: 'medium', targetPosition: 20 },
  { keyword: '高校生 就職情報誌', priority: 'medium', targetPosition: 15 },
  { keyword: '愛知 高校生 求人', priority: 'medium', targetPosition: 20 },
  { keyword: '東海 高校生 就職', priority: 'low', targetPosition: 30 },
] as const;
```

**Search Console API クエリ（lib/search-console.ts:204-206）:**
```typescript
{
  dimension: 'query',
  operator: 'equals',  // ← ここが重要！完全一致のみ
  expression: keyword,
}
```

---

## 🔍 次世代担当者がすべきこと（優先順）

### Phase 1: データの調査（最優先）

1. **Google Search Console の実データ確認**
   - Search Console にログイン
   - 検索パフォーマンス → クエリタブ
   - 過去30日間の上位クエリ10件を記録
   - 「ゆめマガ」で絞り込み検索して、実際にデータがあるか確認

2. **判明すべき情報:**
   - [ ] 「ゆめマガ」という完全一致のクエリで検索されているか？
   - [ ] 「ゆめマガ」を含む複合キーワード（例: 「ゆめマガ とは」）があるか？
   - [ ] Top Queries 44クリックの内訳は何か？
   - [ ] 一般ワード（ブランドワード以外）のクリックは本当に0件か？

3. **調査結果を記録:**
   ```markdown
   # 調査結果（2025-XX-XX）

   ## Top Queries（過去30日間）
   1. ゆめスタ: XX クリック
   2. ゆめスタ 愛知: XX クリック
   3. ...

   ## 「ゆめマガ」関連クエリ
   - ゆめマガ: XX クリック（XX 表示回数、XX位）
   - ゆめマガ とは: XX クリック
   - ...

   ## 一般ワード
   - 高校生 就職 愛知: XX クリック
   - ...
   ```

### Phase 2: ユーザー（マネージャー）へのヒアリング

調査結果をもとに、以下を確認：

1. **キーワード追跡の目的:**
   - 「完全一致のみを追跡したいか？」
   - 「部分一致（例: "ゆめマガ とは"）も含めたいか？」

2. **重要キーワードの優先度:**
   - 現在の8キーワードで十分か？
   - 追加・削除すべきキーワードはあるか？

3. **ブランドワード定義の妥当性:**
   - 現在の定義で問題ないか？
   - 追加すべきバリエーションはあるか？

### Phase 3: 実装の改善

調査結果とユーザー確認をもとに、以下を実装：

#### オプションA: 完全一致のまま維持する場合

- 現在の実装を維持
- ただし、「検索されていません」という表示を改善
- 例: 「このキーワードでの検索実績なし（認知度向上施策を推奨）」

#### オプションB: 部分一致に変更する場合

```typescript
// lib/search-console.ts:204
operator: 'contains',  // 'equals' から変更
```

**注意**: この変更により、すべてのデータの意味が変わります：
- 「ゆめスタ」→ 「ゆめスタ」「ゆめスタ 愛知」「ゆめスタとは」などすべて含む
- 順位も平均値になる

#### オプションC: 両方を表示する場合

- 完全一致と部分一致の両方を取得
- UI で切り替え可能にする
- データ量が2倍になるので、パフォーマンスに注意

---

## 📝 重要な注意事項

### Search Console APIの制約

1. **データ保持期間**: 最大16ヶ月
2. **データ遅延**: 2-3日の遅延がある
3. **クエリ制限**: 1日あたり200リクエストまで
4. **データ精度**:
   - プライバシー保護のため、検索数が少ないクエリは表示されない場合がある
   - 正確な順位ではなく、平均順位が返される

### データの解釈

**「ランク外（999位）」の意味:**
- データが存在しない（検索されていない）
- プライバシー保護により除外された
- 対象期間外のデータ

**これを区別するには `impressions`（表示回数）を確認:**
- `impressions = 0` → 検索されていない
- `impressions > 0` → 検索されているが圏外

---

## 🔗 関連ドキュメント

1. **GA4イベント設定手順**
   - `docs/setup/ga4-conversion-event-setup.md`
   - お問い合わせ数の自動取得設定

2. **SEO/LLMO改善計画**
   - `docs/workflows/analytics-dashboard-improvement-plan.md`
   - HP担当者向けの改善施策ドキュメント

3. **元の引き継ぎドキュメント**
   - `docs/workflows/HANDOFF_ANALYTICS_DASHBOARD.md`
   - 前セッションからの引き継ぎ内容

---

## ✅ 完了の定義

以下がすべて完了したら、このタスクは完了です：

- [ ] Phase 1: データ調査完了（Search Console 実データ確認）
- [ ] Phase 2: ユーザーヒアリング完了（方針決定）
- [ ] Phase 3: 実装改善完了（選択した方針を実装）
- [ ] テスト実施（実データで動作確認）
- [ ] ドキュメント更新（このファイルに調査結果と実装内容を追記）

---

## 🤝 次世代担当者へのメッセージ

このセッションではUI改善を優先しましたが、**データ精度の問題が根本的に解決していません**。

見た目は良くなりましたが、**表示されているデータの信頼性に問題がある**状態です。

必ず Phase 1（データ調査）から開始してください。調査なしで実装を進めると、間違った方向に進む可能性が高いです。

不明点があれば、このドキュメントの「🔍 次世代担当者がすべきこと」を再度読んでください。

頑張ってください！🚀

---

**作成者**: Claude Code (2025-10-06)
**次世代担当者**: [あなたの名前をここに記入]
**調査開始日**: [調査開始時に記入]
**完了予定日**: [Phase 1完了後に記入]
