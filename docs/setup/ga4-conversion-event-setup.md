# GA4お問い合わせイベント設定ガイド

## 概要
このドキュメントは、ゆめスタHP（yumesuta.com）にGA4コンバージョンイベントを設定し、ダッシュボードでお問い合わせ数を自動取得できるようにする手順を説明します。

## 前提条件
- Google Analytics 4 (GA4) が yumesuta.com に設定済み
- お問い合わせフォームが存在する（例: `/contact` ページ）

---

## ステップ1: お問い合わせフォームにGA4イベントを送信

### 方法A: Googleタグマネージャー（GTM）を使用（推奨）

#### 1-1. トリガーの作成
GTMで「フォーム送信」トリガーを作成:

```
トリガーの種類: フォーム送信
このトリガーの発生場所: 一部のフォーム
フォーム条件: Page URL 含む /contact （または該当のURL）
```

#### 1-2. タグの作成
GA4イベントタグを作成:

```
タグの種類: GA4イベント
イベント名: generate_lead
測定ID: G-XXXXXXXXXX （あなたのGA4測定ID）
トリガー: 上記で作成したフォーム送信トリガー
```

**イベントパラメータ（オプション）**:
| パラメータ名 | 値 | 説明 |
|------------|---|-----|
| form_name | contact_form | フォーム識別用 |
| value | 1 | コンバージョン価値 |

#### 1-3. プレビュー＆公開
- GTMプレビューモードでテスト
- フォーム送信時に`generate_lead`イベントが発火することを確認
- 問題なければ公開

---

### 方法B: JavaScriptで直接送信

お問い合わせフォームの送信成功時に以下のコードを追加:

```javascript
// フォーム送信成功時（例: Ajaxコールバック内）
if (typeof gtag !== 'undefined') {
  gtag('event', 'generate_lead', {
    'event_category': 'contact',
    'event_label': 'contact_form_submit',
    'value': 1
  });
}
```

**または、Wix等のCMSを使用している場合**:
```javascript
// Wixの例（フォーム送信成功時）
$w('#contactForm').onSubmit(() => {
  wixWindow.trackEvent('CustomEvent', {
    eventCategory: 'Contact',
    eventAction: 'Form Submit',
    eventLabel: 'generate_lead'
  });
});
```

---

## ステップ2: GA4でコンバージョンとしてマーク

### 2-1. GA4管理画面にアクセス
1. [Google Analytics](https://analytics.google.com/) にログイン
2. 該当のプロパティを選択
3. 左メニュー「管理」→「イベント」

### 2-2. イベントの確認
- `generate_lead`イベントがリストに表示されるまで待つ（最大24〜48時間）
- すぐに確認したい場合: 左メニュー「レポート」→「リアルタイム」でテスト送信を確認

### 2-3. コンバージョンとしてマーク
1. 「イベント」画面で`generate_lead`イベントを探す
2. 右側の「コンバージョンとしてマーク」トグルをONにする
3. これで`generate_lead`が正式なコンバージョンイベントになります

---

## ステップ3: ダッシュボード側の設定（.env.local）

### 3-1. イベント名の設定

`.env.local`ファイルに以下を追加（オプション）:

```bash
# GA4コンバージョンイベント名（デフォルト: generate_lead）
GA4_CONVERSION_EVENT_NAME=generate_lead
```

**別のイベント名を使用する場合**:
- `contact_form_submit`など独自のイベント名を使用した場合は、上記の値を変更してください
- デフォルトは`generate_lead`なので、この名前を使用する場合は設定不要です

### 3-2. 動作確認

ダッシュボードで「更新」ボタンをクリックし、お問い合わせ数が正しく表示されるか確認:

```
過去30日間のお問い合わせ数: X件 / 10件
```

---

## トラブルシューティング

### ❌ お問い合わせ数が常に0件のまま

**原因1: イベントがGA4に送信されていない**
- GTMプレビューモードでイベント発火を確認
- ブラウザのConsoleで`gtag`関数が存在するか確認
- GA4リアルタイムレポートでテスト送信を確認

**原因2: イベント名が間違っている**
- GA4「イベント」画面で実際のイベント名を確認
- `.env.local`の`GA4_CONVERSION_EVENT_NAME`を正しい名前に修正

**原因3: サービスアカウント権限不足**
- GA4プロパティにサービスアカウントが「閲覧者」権限で追加されているか確認
- 権限追加方法: GA4「管理」→「プロパティのアクセス管理」→サービスアカウントメールを追加

---

### ❌ イベントはGA4に届いているが、ダッシュボードで取得できない

**原因: データ反映の遅延**
- GA4イベントは最大24〜48時間の遅延があります
- リアルタイムレポートには表示されるが、Data APIでは取得できない場合があります
- 1〜2日待ってから再度確認してください

---

## 推奨イベント名一覧

GA4では以下の推奨イベント名を使用することで、Googleの機械学習が最適化されます:

| イベント名 | 用途 | 推奨度 |
|-----------|------|--------|
| `generate_lead` | お問い合わせフォーム送信 | ⭐⭐⭐ 最推奨 |
| `contact` | お問い合わせ | ⭐⭐ |
| `submit_form` | フォーム送信全般 | ⭐ |

**本ダッシュボードでは`generate_lead`の使用を推奨します。**

---

## 参考リンク

- [GA4イベントの推奨事項](https://support.google.com/analytics/answer/9267735)
- [Googleタグマネージャーの使い方](https://tagmanager.google.com/)
- [GA4 Data API リファレンス](https://developers.google.com/analytics/devguides/reporting/data/v1)

---

## 完了チェックリスト

設定が完了したら、以下を確認してください:

- [ ] お問い合わせフォームにGA4イベント送信コードを追加
- [ ] GTMまたはJavaScriptでイベントが正しく発火することを確認
- [ ] GA4管理画面で`generate_lead`イベントを確認
- [ ] `generate_lead`を「コンバージョンとしてマーク」に設定
- [ ] ダッシュボードでお問い合わせ数が正しく表示されることを確認

以上で設定完了です！
