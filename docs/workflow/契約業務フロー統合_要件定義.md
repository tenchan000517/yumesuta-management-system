# 契約業務フロー統合 - 要件定義書

**作成日**: 2025年10月11日
**作成者**: 業務マネージャー（Claude Code）
**対象**: システム開発担当（次世代Claude Code）
**目的**: ダッシュボードに契約業務フローを統合し、ミスとギャップのない安全な業務遂行を実現する

---

## 🎯 基本KGI

**「工程ごとにカードになっていて、一個一個丁寧にアシスト（メール文など）がガイドされ、実行していけるようになっている」**

### KGIの意味
- ミスがゼロ（メール例文のコピペ、チェックリストの活用）
- ギャップがゼロ（マニュアルの可視化、手順の明示）
- 安全な業務遂行（組織として標準化された手順）

---

## 📋 統合する業務フローの概要

### 対象業務
**契約から掲載までの13ステップ業務**

### ソースファイル
- **業務フロー**: `/mnt/c/ゆめスタバックエンド/active/契約書作成_業務フローガイド.md`
- **リーガルチェックプロンプト**: `/mnt/c/ゆめスタバックエンド/active/契約書リーガルチェック_プロンプト.md`
- **情報収集フォーマット**: `/mnt/c/ゆめスタバックエンド/active/契約書作成_情報収集フォーマット.md`

### 業務の構造
```
① 情報収集
② 基本契約書作成
③ 基本契約書の押印・送信
④ 申込書作成
⑤ 申込書の押印・送信
⑥ 重要事項説明（推奨・任意）
⑦ 契約完了確認
⑧ 請求書作成・送付
⑨ 入金確認
⑩ 入金管理シート更新
⑪ 入金確認連絡・原稿依頼
⑫ 制作・校正
⑬ 掲載
```

---

## 🏗️ システム統合イメージ

### ダッシュボード構成

```
┌─────────────────────────────────────────────────────┐
│  ゆめスタ統合マネジメントシステム                    │
├─────────────────────────────────────────────────────┤
│  ■ ダッシュボード                                   │
│  □ 営業進捗                                         │
│  □ ゆめマガ制作進捗                                 │
│  □ パートナー・スターデータ                         │
│  □ HP・LLMO分析                                     │
│  □ SNS投稿管理                                      │
│  □ タスク管理                                       │
│  ■ 業務フロー  ← 【新規追加】                      │
│    └─ 契約業務フロー（13ステップ）                 │
└─────────────────────────────────────────────────────┘
```

### タブ追加位置
`app/page.tsx`の既存6機能の下に「業務フロー」タブを追加

---

## 💡 UIコンセプト：ステップカード方式

### 基本設計思想

**「カルーセル形式」または「アコーディオン形式」で、13工程を1つずつ実行していく**

### パターンA：カルーセル形式（推奨）

```
┌──────────────────────────────────────────┐
│  契約業務フロー（13ステップ）            │
├──────────────────────────────────────────┤
│  進捗: ████████░░░░░░░ 8/13 完了        │
│                                          │
│  ┌────────────────────────────────────┐ │
│  │ ステップ⑧ 請求書作成・送付        │ │
│  │ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │ │
│  │                                    │ │
│  │ 【やること】                       │ │
│  │ ✓ マネーフォワードで請求書作成    │ │
│  │ ✓ 件名: 広告掲載費                │ │
│  │ ✓ 品目: ゆめスタマガジン掲載      │ │
│  │                                    │ │
│  │ 【チェックリスト】                 │ │
│  │ □ 単価（税別）を確認              │ │
│  │ □ 支払期限を確認                  │ │
│  │ □ 顧客情報を確認                  │ │
│  │                                    │ │
│  │ 【ガイド・リンク】                 │ │
│  │ ┌─────────────────────────────┐ │ │
│  │ │ 📄 マネーフォワードを開く    │ │ │
│  │ └─────────────────────────────┘ │ │
│  │                                    │ │
│  │ ┌──────┐     ┌──────┐           │ │
│  │ │ 戻る │     │ 次へ │           │ │
│  │ └──────┘     └──────┘           │ │
│  └────────────────────────────────────┘ │
│                                          │
│  ◀ ① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨ ⑩ ⑪ ⑫ ⑬ ▶    │
└──────────────────────────────────────────┘
```

**特徴**:
- 1画面に1ステップのみ表示
- 「次へ」「戻る」でステップを移動
- 進捗バーで全体の進捗を把握
- ステップインジケーターで現在位置を明示

---

### パターンB：アコーディオン形式

```
┌──────────────────────────────────────────┐
│  契約業務フロー（13ステップ）            │
├──────────────────────────────────────────┤
│                                          │
│  ✅ ステップ① 情報収集                  │
│  ✅ ステップ② 基本契約書作成            │
│  ✅ ステップ③ 基本契約書の押印・送信    │
│  ▼ ステップ④ 申込書作成 ──────────────  │
│  │                                      │ │
│  │  【原本URL】                         │ │
│  │  🔗 Googleスプレッドシート           │ │
│  │                                      │ │
│  │  【やること】                        │ │
│  │  ✓ ページ1: 申込書                  │ │
│  │    □ 申込日                         │ │
│  │    □ 顧客情報                       │ │
│  │    □ 契約料金                       │ │
│  │                                      │ │
│  │  【ガイド・リンク】                  │ │
│  │  ┌───────────────────────────────┐ │ │
│  │  │ 📋 チェックリストをコピー      │ │ │
│  │  └───────────────────────────────┘ │ │
│  │                                      │ │
│  │  ┌──────────────┐                   │ │
│  │  │ 完了マーク    │                   │ │
│  │  └──────────────┘                   │ │
│  └──────────────────────────────────────┘ │
│  ▶ ステップ⑤ 申込書の押印・送信        │
│  ▶ ステップ⑥ 重要事項説明              │
│  ▶ ステップ⑦ 契約完了確認              │
│  ...                                     │
└──────────────────────────────────────────┘
```

**特徴**:
- 全13ステップを一覧表示
- クリックして展開・折りたたみ
- 完了したステップはチェックマーク表示
- 全体の流れを把握しやすい

---

## 🎨 各ステップカードの構成要素

### 必須要素

#### 1. ステップタイトル
```
ステップ⑤ 申込書の押印・送信
```

#### 2. ステップ概要
```
マネーフォワードで申込書に押印し、顧客に送信します。
```

#### 3. 【やること】セクション
```
【やること】
1. 押印位置を配置
   - ページ1の契約成立箇所に「印」マーク配置（顧客）
   - ページ1の承諾箇所に「印」マーク配置（ゆめスタ）
   - ページ3の署名欄に「印」マーク配置（顧客）

2. 株式会社ゆめスタが押印
   - 配置した「印」マークをクリック
   - 「押印する」ボタンをクリック

3. 送信
```

#### 4. 【チェックリスト】セクション
```
【チェックリスト】
□ 押印位置は正しいか
□ 顧客情報は正しいか
□ 送信先メールアドレスは正しいか
```

#### 5. 【ガイド・リンク】セクション
```
【ガイド・リンク】
┌─────────────────────────────┐
│ 📧 送信完了メールをコピー    │  ← クリックでメール例文を表示
└─────────────────────────────┘

┌─────────────────────────────┐
│ 🔗 マネーフォワードを開く    │  ← 外部リンク
└─────────────────────────────┘
```

---

### オプション要素

#### 6. 【原本URL】セクション（該当ステップのみ）
```
【原本URL】
Googleドキュメント: [リンク]
※原本をコピーして作成してください
```

#### 7. 【メール例文】モーダル
```
┌──────────────────────────────────────┐
│  送信完了メール                      │
├──────────────────────────────────────┤
│  件名: 【重要】契約書類2点のご確認を │
│        お願いいたします              │
│                                      │
│  〇〇様                              │
│                                      │
│  いつもお世話になっております。      │
│  株式会社ゆめスタの飯田でございます。│
│  ...                                 │
│                                      │
│  ┌────────────┐                     │
│  │ コピーする │                     │
│  └────────────┘                     │
└──────────────────────────────────────┘
```

#### 8. 【注意事項】セクション
```
【注意事項】
⚠ 重要事項説明は任意ですが、積極的に実施を推奨します
⚠ 先方のお時間を頂戴することになるため、丁寧に依頼してください
```

---

## 📱 具体的な実装イメージ

### ステップ⑤ 申込書の押印・送信（カード例）

```typescript
// カードコンポーネントのイメージ
<StepCard
  stepNumber={5}
  title="申込書の押印・送信"
  status="pending" // pending | in_progress | completed
>
  <StepOverview>
    マネーフォワードで申込書に押印し、顧客に送信します。
  </StepOverview>

  <StepActions>
    <h3>【やること】</h3>
    <ol>
      <li>押印位置を配置
        <ul>
          <li>ページ1の契約成立箇所に「印」マーク配置（顧客）</li>
          <li>ページ1の承諾箇所に「印」マーク配置（ゆめスタ）</li>
          <li>ページ3の署名欄に「印」マーク配置（顧客）</li>
        </ul>
      </li>
      <li>株式会社ゆめスタが押印
        <ul>
          <li>配置した「印」マークをクリック</li>
          <li>「押印する」ボタンをクリック</li>
        </ul>
      </li>
      <li>送信</li>
    </ol>
  </StepActions>

  <StepChecklist
    items={[
      '押印位置は正しいか',
      '顧客情報は正しいか',
      '送信先メールアドレスは正しいか'
    ]}
  />

  <StepGuides>
    <GuideButton
      label="📧 送信完了メールをコピー"
      onClick={() => openEmailModal('契約書送信完了メール')}
    />
    <GuideButton
      label="🔗 マネーフォワードを開く"
      href="https://example.com"
      external
    />
  </StepGuides>

  <StepNavigation>
    <Button onClick={previousStep}>戻る</Button>
    <Button onClick={nextStep}>次へ</Button>
  </StepNavigation>
</StepCard>
```

---

## 📊 データ構造の設計

### ステップデータの型定義

```typescript
// types/workflow.ts

export type StepStatus = 'pending' | 'in_progress' | 'completed';

export interface ChecklistItem {
  id: string;
  text: string;
  checked: boolean;
}

export interface GuideLink {
  id: string;
  label: string;
  type: 'modal' | 'external' | 'internal';
  target?: string; // モーダルID or URL
  icon?: string; // 📧 📋 🔗 etc
}

export interface EmailTemplate {
  id: string;
  subject: string;
  body: string;
}

export interface WorkflowStep {
  stepNumber: number;
  title: string;
  overview: string;
  status: StepStatus;

  // やることリスト
  actions: string[]; // HTML可

  // チェックリスト
  checklist: ChecklistItem[];

  // ガイド・リンク
  guides: GuideLink[];

  // オプション要素
  sourceUrl?: string; // 原本URL
  emailTemplate?: EmailTemplate; // メール例文
  notes?: string[]; // 注意事項
}

export interface ContractWorkflow {
  id: string;
  name: string;
  description: string;
  totalSteps: number;
  currentStep: number;
  steps: WorkflowStep[];
}
```

---

## 🔧 実装すべき機能

### 必須機能

#### 1. ステップ表示機能
- [ ] 13ステップのカード表示（カルーセルまたはアコーディオン）
- [ ] ステップごとの詳細情報表示
- [ ] 進捗インジケーター（X/13完了）

#### 2. ナビゲーション機能
- [ ] 「次へ」「戻る」ボタン
- [ ] ステップ番号クリックでジャンプ
- [ ] 完了ステップと未完了ステップの視覚的区別

#### 3. チェックリスト機能
- [ ] チェックボックスのON/OFF
- [ ] チェック状態の保存（LocalStorage）
- [ ] 全チェック完了時の視覚的フィードバック

#### 4. ガイド機能
- [ ] メール例文のモーダル表示
- [ ] メール例文のコピーボタン
- [ ] 外部リンク（別タブで開く）
- [ ] 内部リンク（原本URL等）

#### 5. ステータス管理機能
- [ ] ステップごとのステータス（pending/in_progress/completed）
- [ ] ステータスの保存（LocalStorage）
- [ ] 全体進捗の計算・表示

---

### 推奨機能（Phase 2以降）

#### 6. 入力補助機能
- [ ] 顧客情報の入力フォーム
- [ ] Google Sheetsへの自動反映（読み書き）
- [ ] テンプレート自動生成

#### 7. リマインダー機能
- [ ] 期日の設定
- [ ] アラート表示（期日が近い、期日超過）

#### 8. 履歴管理機能
- [ ] 過去の契約業務の履歴表示
- [ ] 顧客ごとの進捗確認

---

## 📁 ファイル構成

### 作成するファイル

```
/app/dashboard/workflow/
  └─ contract/
      └─ page.tsx          # 契約業務フローページ

/components/workflow/
  ├─ StepCard.tsx          # ステップカードコンポーネント
  ├─ StepChecklist.tsx     # チェックリストコンポーネント
  ├─ StepGuide.tsx         # ガイド・リンクコンポーネント
  ├─ EmailModal.tsx        # メール例文モーダル
  └─ ProgressBar.tsx       # 進捗バーコンポーネント

/types/
  └─ workflow.ts           # 業務フロー関連の型定義

/data/
  └─ contract-workflow.ts  # 契約業務フローの13ステップデータ
      └─ email-templates.ts # メール例文データ

/lib/
  └─ workflow-storage.ts   # LocalStorageへのステータス保存
```

---

## 📝 データファイルの内容例

### `/data/contract-workflow.ts`

```typescript
import { ContractWorkflow } from '@/types/workflow';

export const contractWorkflow: ContractWorkflow = {
  id: 'contract-workflow-v1',
  name: '契約業務フロー',
  description: '契約から掲載までの13ステップ',
  totalSteps: 13,
  currentStep: 1,
  steps: [
    {
      stepNumber: 1,
      title: '情報収集',
      overview: '顧客に情報収集フォーマットを送信し、必要な情報を収集します。',
      status: 'pending',
      actions: [
        '顧客に「契約書作成_情報収集フォーマット」を送信',
        '記入してもらう'
      ],
      checklist: [
        { id: 's1-c1', text: '企業名は正式名称か', checked: false },
        { id: 's1-c2', text: '住所は「番地」「号」まで記載されているか', checked: false },
        { id: 's1-c3', text: '代表者役職が記入されているか', checked: false },
        { id: 's1-c4', text: '支払期限が記載されているか', checked: false }
      ],
      guides: [
        {
          id: 's1-g1',
          label: '📋 情報収集フォーマットを開く',
          type: 'internal',
          target: '/mnt/c/ゆめスタバックエンド/active/契約書作成_情報収集フォーマット.md',
          icon: '📋'
        }
      ]
    },
    {
      stepNumber: 2,
      title: '基本契約書作成',
      overview: '原本をコピーして顧客情報を入力し、基本契約書を作成します。',
      status: 'pending',
      actions: [
        '冒頭の企業名を修正',
        '下部の顧客情報と日付を更新'
      ],
      checklist: [
        { id: 's2-c1', text: '企業名が正しく修正されているか', checked: false },
        { id: 's2-c2', text: '住所が正しく入力されているか', checked: false },
        { id: 's2-c3', text: '代表者名が正しく入力されているか', checked: false },
        { id: 's2-c4', text: '契約締結日が正しいか', checked: false }
      ],
      guides: [
        {
          id: 's2-g1',
          label: '🔗 広告掲載基本契約書（原本）を開く',
          type: 'external',
          target: 'https://docs.google.com/document/d/1B_GK3cknmtgGgpKVjKUerOOgQ7RgQcwwdLMBy12gBDo/edit?tab=t.0',
          icon: '🔗'
        }
      ],
      sourceUrl: 'https://docs.google.com/document/d/1B_GK3cknmtgGgpKVjKUerOOgQ7RgQcwwdLMBy12gBDo/edit?tab=t.0',
      notes: [
        '原本をコピーして作成してください',
        '【甲の会社名・団体名】等のプレースホルダーを置換してください'
      ]
    },
    // ... 残り11ステップを定義
  ]
};
```

### `/data/email-templates.ts`

```typescript
import { EmailTemplate } from '@/types/workflow';

export const emailTemplates: Record<string, EmailTemplate> = {
  '契約書送信完了メール': {
    id: 'contract-send-complete',
    subject: '【重要】契約書類2点のご確認をお願いいたします',
    body: `〇〇様

いつもお世話になっております。
株式会社ゆめスタの飯田でございます。

この度は、弊社「ゆめスタマガジン」への広告掲載に
お申し込みいただき、誠にありがとうございます。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【契約書類のご確認について】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

マネーフォワードより、以下2点の契約書類を
お送りいたしましたので、ご確認をお願いいたします。

①「広告掲載基本契約書」
②「広告掲載申込書兼個別契約書」

※マネーフォワードからのメールが届いておりますので、
　そちらのリンクから書類をご確認いただけます。

...

株式会社ゆめスタ
飯田思遠
TEL: 090-4264-9939
Email: info@yumesuta.com`
  },

  '入金確認メール': {
    id: 'payment-confirm',
    subject: '入金確認のご連絡・原稿情報のご提出について',
    body: `〇〇様

お世話になっております。
株式会社ゆめスタの飯田です。

この度は、ご入金いただきありがとうございました。
入金を確認いたしましたので、ご連絡申し上げます。

...`
  }

  // 他のメール例文も追加
};
```

---

## 🎨 UI設計の詳細

### カラースキーム

```typescript
// ステータスカラー
const statusColors = {
  pending: 'bg-gray-100 text-gray-800',
  in_progress: 'bg-blue-100 text-blue-800',
  completed: 'bg-green-100 text-green-800'
};

// アイコンカラー
const iconColors = {
  checklist: 'text-blue-500',
  email: 'text-green-500',
  link: 'text-purple-500',
  warning: 'text-yellow-500'
};
```

### レスポンシブデザイン

- **PC**: カルーセル形式、幅800px
- **タブレット**: カルーセル形式、幅100%
- **スマホ**: アコーディオン形式に切り替え

---

## ⚙️ 技術仕様

### 使用技術

- **フレームワーク**: Next.js 15 (App Router)
- **スタイリング**: Tailwind CSS v4
- **アイコン**: lucide-react
- **状態管理**: React useState + LocalStorage
- **型定義**: TypeScript

### データ永続化

```typescript
// lib/workflow-storage.ts

export const saveWorkflowState = (workflowId: string, state: WorkflowState) => {
  localStorage.setItem(`workflow_${workflowId}`, JSON.stringify(state));
};

export const loadWorkflowState = (workflowId: string): WorkflowState | null => {
  const data = localStorage.getItem(`workflow_${workflowId}`);
  return data ? JSON.parse(data) : null;
};

export interface WorkflowState {
  currentStep: number;
  stepStatuses: Record<number, StepStatus>;
  checklistStates: Record<string, boolean>;
}
```

---

## 🚀 実装フェーズ

### Phase 1: 基本表示機能（MVP）

**目標**: ステップカードの表示とナビゲーション

- [ ] 型定義作成（`types/workflow.ts`）
- [ ] データファイル作成（`data/contract-workflow.ts`）
- [ ] ステップカードコンポーネント作成
- [ ] ダッシュボードページ作成（`app/dashboard/workflow/contract/page.tsx`）
- [ ] カルーセルナビゲーション実装
- [ ] 進捗バー実装

**完了条件**: 13ステップを「次へ」「戻る」で移動でき、各ステップの詳細が表示される

---

### Phase 2: インタラクション機能

**目標**: チェックリストとガイド機能

- [ ] チェックリスト機能実装
- [ ] LocalStorageへのステータス保存
- [ ] メール例文モーダル実装
- [ ] コピーボタン実装
- [ ] 外部リンクボタン実装

**完了条件**: チェックリストをチェックでき、メール例文をコピーできる

---

### Phase 3: 高度な機能

**目標**: ステータス管理と履歴機能

- [ ] ステップごとのステータス管理
- [ ] 完了/未完了の視覚的区別
- [ ] 過去の契約履歴表示
- [ ] リセット機能

**完了条件**: 契約業務の進捗を完全に管理できる

---

## 📌 重要な注意事項

### システム開発担当者への指示

#### 1. 既存システムとの整合性を保つ
- 既存の6機能（営業進捗、ゆめマガ制作進捗等）と同じUI/UX
- 同じカラースキーム、同じボタンスタイル
- `app/page.tsx`のナビゲーションに追加

#### 2. MVP範囲を守る
- ❌ Google Sheetsへの書き込みは不要（Phase 1では表示のみ）
- ❌ 自動リマインダーは不要
- ✅ LocalStorageでの状態保存のみ

#### 3. データは静的ファイルで管理
- `/data/contract-workflow.ts`に13ステップをハードコード
- メール例文も静的データ
- Google Sheets連携は Phase 2以降

#### 4. アイコンは`lucide-react`のみ使用
```typescript
import { CheckCircle, Circle, Mail, Link, FileText } from 'lucide-react';
```

---

## 🧪 テストシナリオ

### 基本動作テスト

1. ダッシュボードから「業務フロー」→「契約業務フロー」に移動
2. ステップ①が表示される
3. 「次へ」ボタンでステップ②に移動
4. 「戻る」ボタンでステップ①に戻る
5. チェックリストをチェック
6. メール例文ボタンをクリック→モーダルが開く
7. コピーボタンをクリック→クリップボードにコピーされる
8. ページを再読み込み→チェック状態が保存されている

---

## 📖 参考資料

### システム開発担当者が読むべきファイル

1. **業務フローの詳細**: `/mnt/c/ゆめスタバックエンド/active/契約書作成_業務フローガイド.md`
2. **システム概要**: `/mnt/c/yumesuta-management-system/docs/SYSTEM_OVERVIEW.md`
3. **開発ガイド**: `/mnt/c/yumesuta-management-system/CLAUDE.md`

### 既存コンポーネントの参考

- **カード表示**: `components/` 配下の既存コンポーネント
- **ボタンスタイル**: `app/page.tsx` のナビゲーションボタン
- **ダッシュボードレイアウト**: `app/dashboard/sales/page.tsx` 等

---

## ✅ 完成イメージのチェックリスト

システム開発担当者は、以下が実現できていることを確認してください：

- [ ] ダッシュボードに「業務フロー」タブが追加されている
- [ ] 契約業務フローの13ステップがカード形式で表示される
- [ ] 「次へ」「戻る」でステップを移動できる
- [ ] 進捗バーが表示され、進捗状況が分かる
- [ ] 各ステップに「やること」「チェックリスト」「ガイド」が表示される
- [ ] チェックリストをチェックできる
- [ ] メール例文ボタンをクリックするとモーダルが開く
- [ ] コピーボタンでメール例文をコピーできる
- [ ] 外部リンクボタンで原本URLを開ける
- [ ] ページを再読み込みしてもチェック状態が保存されている
- [ ] 既存の6機能と同じデザインで統一されている

---

## 🎯 KGIの達成基準

以下が実現できていれば、基本KGI「ミスとギャップのない安全な業務遂行」を達成：

### ✅ ミスがゼロ
- メール例文をコピペで使える
- チェックリストで確認漏れを防止
- 手順が明確に表示される

### ✅ ギャップがゼロ
- 13ステップ全てが可視化されている
- 次に何をすべきか一目で分かる
- マニュアルを見なくても実行できる

### ✅ 安全な業務遂行
- 組織として標準化された手順
- 誰が実行しても同じ品質
- 新人でもミスなく実行できる

---

**作成日**: 2025年10月11日
**作成者**: 業務マネージャー（Claude Code）
**最終更新**: 2025年10月11日

以上
