# 契約業務フロー統合 - 実装草案

**作成日**: 2025年10月11日
**作成者**: Claude Code
**目的**: フェーズ1・2の調査結果とディスカッションを元に、実装方針を明確化する

---

## 🎯 実装方針の決定事項

### 1. UI形式: カードグリッド + Notion風サイドパネル

**採用理由**:
- 既存システムとの整合性を保ちつつ、視覚的な進捗管理が可能
- 13ステップ全体を一覧で把握できる
- 詳細情報はサイドパネルで展開し、メインエリアを圧迫しない

### 2. プログレスバー: スクロール追従型マイルストーン

**採用理由**:
- 常に進捗状況を確認可能
- 主要なマイルストーン（①③⑦⑨⑬）を視覚的に表現
- 半透明背景でコンテンツを妨げない

### 3. データ管理: 静的データ + Google Sheets連動（読み取りのみ）

**Phase 1の方針**:
- 13ステップの詳細情報は静的ファイルで管理
- 契約・入金管理シートのデータを読み取り表示
- 進捗状態はLocalStorageで保存

---

## 🎨 UI設計詳細

### 全体レイアウト

```
┌──────────────────────────────────────────────────────────────┐
│ 🔝 プログレスバー（固定・半透明・スクロール追従）              │
│ ●━━━●━━━●━━━○━━━○                                          │
│ ① 情報 ③ 契約 ⑦ 完了 ⑨ 入金 ⑬ 掲載                        │
├──────────────────────────────────────────────────────────────┤
│ 戻るボタン                                   更新ボタン       │
│                                                              │
│ バックオフィス業務フロー > 契約業務フロー                     │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│ メインエリア（フル幅）                                        │
│                                                              │
│ 📊 5カラムカードグリッド:                                     │
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐              │
│ │ ✅  │ │ ✅  │ │ ✅  │ │ 🔵  │ │ ⬜  │              │
│ │ ①  │ │ ②  │ │ ③  │ │ ④  │ │ ⑤  │              │
│ │情報 │ │契約 │ │押印 │ │申込 │ │押印 │              │
│ │収集 │ │書作成│ │送信 │ │書作成│ │送信 │              │
│ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘              │
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐              │
│ │ ⬜  │ │ ⬜  │ │ ⬜  │ │ ⬜  │ │ ⬜  │              │
│ │ ⑥  │ │ ⑦  │ │ ⑧  │ │ ⑨  │ │ ⑩  │              │
│ │重要 │ │契約 │ │請求 │ │入金 │ │入金 │              │
│ │説明 │ │完了 │ │書  │ │確認 │ │更新 │              │
│ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘              │
│ ┌─────┐ ┌─────┐ ┌─────┐                                │
│ │ ⬜  │ │ ⬜  │ │ ⬜  │                                │
│ │ ⑪  │ │ ⑫  │ │ ⑬  │                                │
│ │原稿 │ │制作 │ │掲載 │                                │
│ │依頼 │ │校正 │ │    │                                │
│ └─────┘ └─────┘ └─────┘                                │
│                                                              │
│ 📊 下部: スプレッドシート連動エリア                           │
│ ┌────────────────────┐ ┌────────────────────┐             │
│ │ 契約・入金管理       │ │ Google Drive       │             │
│ │ （テーブル表示）     │ │ エビデンス一覧     │             │
│ └────────────────────┘ └────────────────────┘             │
└──────────────────────────────────────────────────────────────┘

カードクリック時: サイドパネルが右からスライドイン
┌──────────────────────────────┬───────────────────────────┐
│ メインエリア（暗転）          │ サイドパネル               │
│ （背景: bg-black/30）         │ （右から300msでスライド）  │
│                              │ ┌─────────────────────┐ │
│                              │ │ 🔵 ④ 申込書作成     │ │
│                              │ │ ──────────────────  │ │
│                              │ │                     │ │
│                              │ │ 【概要】            │ │
│                              │ │ 原本をコピーして... │ │
│                              │ │                     │ │
│                              │ │ 【やること】        │ │
│                              │ │ ☑ ページ1: 申込書  │ │
│                              │ │ ☑ 申込日を入力      │ │
│                              │ │                     │ │
│                              │ │ 【入力フォーム】    │ │
│                              │ │ 申込日: [input] [更新]│ │
│                              │ │                     │ │
│                              │ │ 【チェックリスト】  │ │
│                              │ │ □ 押印位置は正しいか│ │
│                              │ │ □ 顧客情報は正しいか│ │
│                              │ │                     │ │
│                              │ │ 【ガイド】          │ │
│                              │ │ [📄 原本を開く]    │ │
│                              │ │ [📧 メールコピー]  │ │
│                              │ │                     │ │
│                              │ │ [閉じる]  [更新]    │ │
│                              │ └─────────────────────┘ │
└──────────────────────────────┴───────────────────────────┘
```

---

## 🧩 コンポーネント設計

### ページコンポーネント

**ファイルパス**: `app/dashboard/workflow/contract/page.tsx`

**主要State**:
```tsx
const [selectedStep, setSelectedStep] = useState<number | null>(null);
const [stepStatuses, setStepStatuses] = useState<Record<number, StepStatus>>({});
const [contractData, setContractData] = useState<ContractData[]>([]);
const [driveFiles, setDriveFiles] = useState<DriveFile[]>([]);
const [loading, setLoading] = useState(false);
```

---

### 1. プログレスバー（`components/workflow/ProgressBar.tsx`）

**Props**:
```tsx
interface ProgressBarProps {
  milestones: Milestone[];  // ①③⑦⑨⑬
  currentStep: number;
  completedSteps: number[];
}
```

**実装**:
```tsx
<div className="sticky top-0 z-50 bg-white/80 backdrop-blur-sm border-b border-gray-200 py-4 px-8 transition-all">
  <div className="max-w-7xl mx-auto">
    <div className="flex items-center justify-between">
      {milestones.map((milestone, index) => (
        <React.Fragment key={milestone.stepNumber}>
          <div className="flex items-center gap-2">
            <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${
              completedSteps.includes(milestone.stepNumber)
                ? 'bg-green-500 text-white'
                : currentStep === milestone.stepNumber
                ? 'bg-blue-500 text-white'
                : 'bg-gray-300 text-gray-600'
            }`}>
              {completedSteps.includes(milestone.stepNumber) ? '✓' : milestone.stepNumber}
            </div>
            <span className="text-xs font-semibold text-gray-700 hidden md:block">
              {milestone.label}
            </span>
          </div>
          {index < milestones.length - 1 && (
            <div className={`flex-1 h-1 mx-2 ${
              completedSteps.includes(milestone.stepNumber)
                ? 'bg-green-500'
                : 'bg-gray-300'
            }`} />
          )}
        </React.Fragment>
      ))}
    </div>
  </div>
</div>
```

---

### 2. ステップカード（`components/workflow/StepCard.tsx`）

**Props**:
```tsx
interface StepCardProps {
  step: WorkflowStep;
  status: StepStatus;
  onClick: () => void;
}
```

**実装**:
```tsx
<div
  onClick={onClick}
  className={`rounded-lg p-4 cursor-pointer hover:shadow-lg transition-all border-2 ${
    status === 'completed'
      ? 'bg-green-50 border-green-200'
      : status === 'in_progress'
      ? 'bg-blue-50 border-blue-500'
      : 'bg-gray-50 border-gray-200'
  }`}
>
  <div className="flex items-center gap-2 mb-2">
    {status === 'completed' ? (
      <CheckCircle2 className="w-6 h-6 text-green-600" />
    ) : status === 'in_progress' ? (
      <Circle className="w-6 h-6 text-blue-600 fill-blue-600" />
    ) : (
      <Circle className="w-6 h-6 text-gray-400" />
    )}
    <span className={`text-xs font-bold ${
      status === 'completed' ? 'text-green-600' :
      status === 'in_progress' ? 'text-blue-600' :
      'text-gray-500'
    }`}>
      {status === 'completed' ? '完了' : status === 'in_progress' ? '進行中' : '未着手'}
    </span>
  </div>
  <h3 className={`text-sm font-bold ${
    status === 'pending' ? 'text-gray-700' : 'text-gray-900'
  }`}>
    {step.stepNumber}. {step.title}
  </h3>
</div>
```

---

### 3. サイドパネル（`components/workflow/SidePanel.tsx`）

**Props**:
```tsx
interface SidePanelProps {
  step: WorkflowStep | null;
  isOpen: boolean;
  onClose: () => void;
  onUpdate: (stepNumber: number) => void;
}
```

**実装**:
```tsx
// 背景オーバーレイ
{isOpen && (
  <div
    className="fixed inset-0 bg-black/30 z-40 transition-opacity"
    onClick={onClose}
  />
)}

// サイドパネル
<div className={`
  fixed top-0 right-0 h-full w-full md:w-2/5 md:max-w-2xl
  bg-white shadow-2xl z-50
  transform transition-transform duration-300 ease-in-out
  overflow-y-auto
  ${isOpen ? 'translate-x-0' : 'translate-x-full'}
`}>
  {step && (
    <div className="p-8">
      {/* ヘッダー */}
      <div className="flex items-center justify-between mb-6">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold">
            {step.stepNumber}
          </div>
          <h2 className="text-2xl font-bold text-gray-900">{step.title}</h2>
        </div>
        <button
          onClick={onClose}
          className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
        >
          <X className="w-6 h-6" />
        </button>
      </div>

      {/* 概要 */}
      <div className="mb-6 p-4 bg-blue-50 rounded-lg">
        <p className="text-sm text-gray-700">{step.overview}</p>
      </div>

      {/* やることリスト */}
      <section className="mb-6">
        <h3 className="text-lg font-bold text-gray-900 mb-3 flex items-center gap-2">
          <ListTodo className="w-5 h-5 text-blue-600" />
          【やること】
        </h3>
        <ol className="space-y-2 text-sm text-gray-700 list-decimal list-inside">
          {step.actions.map((action, idx) => (
            <li key={idx} dangerouslySetInnerHTML={{ __html: action }} />
          ))}
        </ol>
      </section>

      {/* 入力フォーム（Phase 2で実装） */}
      {step.inputFields && (
        <section className="mb-6">
          <h3 className="text-lg font-bold text-gray-900 mb-3 flex items-center gap-2">
            <Edit className="w-5 h-5 text-blue-600" />
            【入力フォーム】
          </h3>
          <div className="space-y-3">
            {/* フォームフィールド */}
          </div>
        </section>
      )}

      {/* チェックリスト */}
      <section className="mb-6">
        <h3 className="text-lg font-bold text-gray-900 mb-3 flex items-center gap-2">
          <CheckSquare className="w-5 h-5 text-blue-600" />
          【チェックリスト】
        </h3>
        <div className="space-y-2">
          {step.checklist.map((item) => (
            <label key={item.id} className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors">
              <input
                type="checkbox"
                checked={item.checked}
                onChange={() => handleChecklistToggle(item.id)}
                className="w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"
              />
              <span className="text-sm text-gray-700">{item.text}</span>
            </label>
          ))}
        </div>
      </section>

      {/* ガイドボタン */}
      <section className="mb-6">
        <h3 className="text-lg font-bold text-gray-900 mb-3 flex items-center gap-2">
          <Lightbulb className="w-5 h-5 text-blue-600" />
          【ガイド】
        </h3>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
          {step.guides.map((guide) => (
            <button
              key={guide.id}
              onClick={() => handleGuideClick(guide)}
              className={`flex items-center gap-2 px-4 py-3 rounded-lg font-medium transition-colors ${
                guide.type === 'modal'
                  ? 'bg-green-100 text-green-800 hover:bg-green-200'
                  : 'bg-purple-100 text-purple-800 hover:bg-purple-200'
              }`}
            >
              {guide.icon === '📧' && <Mail className="w-5 h-5" />}
              {guide.icon === '📄' && <FileText className="w-5 h-5" />}
              {guide.icon === '🔗' && <Link className="w-5 h-5" />}
              <span className="text-sm">{guide.label}</span>
            </button>
          ))}
        </div>
      </section>

      {/* 注意事項 */}
      {step.notes && step.notes.length > 0 && (
        <section className="mb-6">
          <div className="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
            <h3 className="text-sm font-bold text-yellow-800 mb-2 flex items-center gap-2">
              <AlertTriangle className="w-5 h-5" />
              注意事項
            </h3>
            <ul className="space-y-1 text-sm text-yellow-700">
              {step.notes.map((note, idx) => (
                <li key={idx}>{note}</li>
              ))}
            </ul>
          </div>
        </section>
      )}

      {/* フッター */}
      <div className="sticky bottom-0 bg-white border-t pt-4 mt-8 -mx-8 px-8 pb-8">
        <div className="flex gap-3">
          <button
            onClick={onClose}
            className="flex-1 px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium"
          >
            閉じる
          </button>
          <button
            onClick={() => onUpdate(step.stepNumber)}
            className="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"
          >
            更新
          </button>
        </div>
      </div>
    </div>
  )}
</div>
```

---

### 4. メール例文モーダル（`components/workflow/EmailModal.tsx`）

**Props**:
```tsx
interface EmailModalProps {
  email: EmailTemplate | null;
  isOpen: boolean;
  onClose: () => void;
}
```

**実装**:
```tsx
{isOpen && email && (
  <div className="fixed inset-0 bg-black/50 z-60 flex items-center justify-center p-4">
    <div className="bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden">
      <div className="p-6 border-b">
        <div className="flex items-center justify-between">
          <h3 className="text-xl font-bold text-gray-900">メール例文</h3>
          <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-lg">
            <X className="w-6 h-6" />
          </button>
        </div>
      </div>
      <div className="p-6 overflow-y-auto max-h-[60vh]">
        <div className="mb-4">
          <label className="text-sm font-semibold text-gray-700 mb-1 block">件名:</label>
          <p className="text-sm text-gray-900 p-3 bg-gray-50 rounded">{email.subject}</p>
        </div>
        <div>
          <label className="text-sm font-semibold text-gray-700 mb-1 block">本文:</label>
          <pre className="text-sm text-gray-900 p-4 bg-gray-50 rounded whitespace-pre-wrap font-sans">
            {email.body}
          </pre>
        </div>
      </div>
      <div className="p-6 border-t flex gap-3">
        <button
          onClick={onClose}
          className="flex-1 px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50"
        >
          閉じる
        </button>
        <button
          onClick={() => {
            navigator.clipboard.writeText(`件名: ${email.subject}\n\n${email.body}`);
            alert('クリップボードにコピーしました');
          }}
          className="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center justify-center gap-2"
        >
          <Copy className="w-5 h-5" />
          コピー
        </button>
      </div>
    </div>
  </div>
)}
```

---

### 5. スプレッドシート連動テーブル（`components/workflow/ContractTable.tsx`）

**Props**:
```tsx
interface ContractTableProps {
  contracts: ContractData[];
  loading: boolean;
}
```

**実装**:
```tsx
<div className="bg-white rounded-lg shadow p-6">
  <h3 className="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
    <Table className="w-5 h-5 text-blue-600" />
    契約・入金管理
  </h3>
  {loading ? (
    <div className="animate-pulse space-y-2">
      {[1, 2, 3].map(i => (
        <div key={i} className="h-12 bg-gray-200 rounded"></div>
      ))}
    </div>
  ) : (
    <div className="overflow-x-auto">
      <table className="min-w-full divide-y divide-gray-200">
        <thead>
          <tr className="bg-gray-50">
            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700">企業名</th>
            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700">契約日</th>
            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700">契約金額</th>
            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700">入金予定日</th>
            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700">入金実績日</th>
            <th className="px-4 py-3 text-left text-xs font-semibold text-gray-700">ステータス</th>
          </tr>
        </thead>
        <tbody className="divide-y divide-gray-200">
          {contracts.map((contract) => (
            <tr key={contract.id} className="hover:bg-gray-50">
              <td className="px-4 py-3 text-sm text-gray-900">{contract.companyName}</td>
              <td className="px-4 py-3 text-sm text-gray-600">{contract.contractDate}</td>
              <td className="px-4 py-3 text-sm text-gray-900 font-semibold">{contract.amount}</td>
              <td className="px-4 py-3 text-sm text-gray-600">{contract.paymentDueDate}</td>
              <td className="px-4 py-3 text-sm text-gray-600">{contract.paymentActualDate || '-'}</td>
              <td className="px-4 py-3">
                <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold ${
                  contract.paymentStatus === '入金済'
                    ? 'bg-green-100 text-green-800'
                    : 'bg-yellow-100 text-yellow-800'
                }`}>
                  {contract.paymentStatus}
                </span>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  )}
</div>
```

---

### 6. Google Driveファイル一覧（`components/workflow/DriveFilesList.tsx`）

**Props**:
```tsx
interface DriveFilesListProps {
  files: DriveFile[];
  loading: boolean;
}
```

**実装**:
```tsx
<div className="bg-white rounded-lg shadow p-6">
  <h3 className="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
    <FolderOpen className="w-5 h-5 text-blue-600" />
    Google Drive エビデンス
  </h3>
  {loading ? (
    <div className="animate-pulse space-y-2">
      {[1, 2, 3].map(i => (
        <div key={i} className="h-10 bg-gray-200 rounded"></div>
      ))}
    </div>
  ) : files.length === 0 ? (
    <p className="text-sm text-gray-500">エビデンスファイルがありません</p>
  ) : (
    <div className="space-y-2">
      {files.map((file) => (
        <a
          key={file.id}
          href={file.webViewLink}
          target="_blank"
          rel="noopener noreferrer"
          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"
        >
          <FileText className="w-5 h-5 text-blue-600" />
          <span className="text-sm text-gray-900">{file.name}</span>
          <ExternalLink className="w-4 h-4 text-gray-400 ml-auto" />
        </a>
      ))}
    </div>
  )}
</div>
```

---

## 📊 データフロー設計

### 1. ページマウント時

```
ページマウント
  ↓
useEffect実行
  ↓
Promise.all([
  fetch('/api/contract/list'),      // 契約・入金管理データ取得
  fetch('/api/drive/files'),         // Driveファイル一覧取得（Phase 2）
])
  ↓
データ整形・State更新
  ↓
LocalStorageから進捗状態を復元
  ↓
画面表示
```

### 2. カードクリック時

```
カードクリック
  ↓
setSelectedStep(stepNumber)
  ↓
サイドパネル展開（300msアニメーション）
  ↓
ステップ詳細表示
```

### 3. チェックリスト更新時

```
チェックボックスクリック
  ↓
State更新
  ↓
LocalStorageに保存
  {
    workflow_contract_state: {
      stepStatuses: { 1: 'completed', 4: 'in_progress', ... },
      checklists: { 's1-c1': true, 's1-c2': false, ... }
    }
  }
```

### 4. 手動更新ボタンクリック時

```
更新ボタンクリック
  ↓
setLoading(true)
  ↓
Promise.all([
  fetch('/api/contract/list'),
  fetch('/api/drive/files'),
])
  ↓
データ整形・State更新
  ↓
setLoading(false)
  ↓
最終更新時刻を表示
```

---

## 🗂️ ファイル構成

```
/app/dashboard/workflow/contract/
  └─ page.tsx                          # メインページ

/components/workflow/
  ├─ ProgressBar.tsx                   # プログレスバー
  ├─ StepCard.tsx                      # ステップカード
  ├─ SidePanel.tsx                     # サイドパネル
  ├─ EmailModal.tsx                    # メール例文モーダル
  ├─ ContractTable.tsx                 # 契約・入金管理テーブル
  └─ DriveFilesList.tsx                # Driveファイル一覧

/types/
  └─ workflow.ts                       # 業務フロー関連の型定義

/data/
  ├─ contract-workflow.ts              # 13ステップの詳細データ
  └─ email-templates.ts                # メール例文データ

/lib/
  └─ workflow-storage.ts               # LocalStorage管理
```

---

## 🔧 型定義

### types/workflow.ts

```typescript
export type StepStatus = 'pending' | 'in_progress' | 'completed';

export interface ChecklistItem {
  id: string;
  text: string;
  checked: boolean;
}

export interface GuideLink {
  id: string;
  label: string;
  type: 'modal' | 'external' | 'internal';
  target?: string;
  icon?: string;
}

export interface EmailTemplate {
  id: string;
  subject: string;
  body: string;
}

export interface WorkflowStep {
  stepNumber: number;
  title: string;
  overview: string;
  status: StepStatus;
  actions: string[];
  checklist: ChecklistItem[];
  guides: GuideLink[];
  inputFields?: InputField[];  // Phase 2で実装
  sourceUrl?: string;
  emailTemplate?: EmailTemplate;
  notes?: string[];
}

export interface Milestone {
  stepNumber: number;
  label: string;
}

export interface ContractData {
  id: number;
  companyName: string;
  contractService: string;
  contractDate: string;
  amount: string;
  paymentMethod: string;
  contractSentDate?: string;
  contractReceivedDate?: string;
  applicationSentDate?: string;
  applicationReceivedDate?: string;
  paymentDueDate: string;
  paymentActualDate?: string;
  paymentStatus: string;
  delayDays?: number;
  publicationIssue: string;
  notes?: string;
}

export interface DriveFile {
  id: string;
  name: string;
  mimeType: string;
  webViewLink: string;
  createdTime: string;
}

export interface WorkflowState {
  stepStatuses: Record<number, StepStatus>;
  checklists: Record<string, boolean>;
}
```

---

## 📁 静的データファイル

### data/contract-workflow.ts

```typescript
import { WorkflowStep } from '@/types/workflow';

export const contractWorkflowSteps: WorkflowStep[] = [
  {
    stepNumber: 1,
    title: '情報収集',
    overview: '顧客に情報収集フォーマットを送信し、契約に必要な情報を収集します。',
    status: 'pending',
    actions: [
      '顧客に「契約書作成_情報収集フォーマット」を送信',
      '記入してもらう'
    ],
    checklist: [
      { id: 's1-c1', text: '企業名は正式名称か', checked: false },
      { id: 's1-c2', text: '住所は「番地」「号」まで記載されているか', checked: false },
      { id: 's1-c3', text: '代表者役職が記入されているか', checked: false },
      { id: 's1-c4', text: '支払期限が記載されているか', checked: false }
    ],
    guides: [
      {
        id: 's1-g1',
        label: '情報収集フォーマット',
        type: 'internal',
        target: '/mnt/c/ゆめスタバックエンド/active/契約書作成_情報収集フォーマット.md',
        icon: '📋'
      }
    ]
  },
  {
    stepNumber: 2,
    title: '基本契約書作成',
    overview: 'Google Docsの原本をコピーして、顧客情報を入力し基本契約書を作成します。',
    status: 'pending',
    actions: [
      '原本をコピー',
      '冒頭の企業名を修正',
      '下部の顧客情報（住所、代表者名、契約締結日）を更新'
    ],
    checklist: [
      { id: 's2-c1', text: '企業名が正しく修正されているか', checked: false },
      { id: 's2-c2', text: '住所が正しく入力されているか', checked: false },
      { id: 's2-c3', text: '代表者名が正しく入力されているか', checked: false },
      { id: 's2-c4', text: '契約締結日が正しいか', checked: false }
    ],
    guides: [
      {
        id: 's2-g1',
        label: '原本を開く',
        type: 'external',
        target: 'https://docs.google.com/document/d/1B_GK3cknmtgGgpKVjKUerOOgQ7RgQcwwdLMBy12gBDo/edit?tab=t.0',
        icon: '🔗'
      }
    ],
    sourceUrl: 'https://docs.google.com/document/d/1B_GK3cknmtgGgpKVjKUerOOgQ7RgQcwwdLMBy12gBDo/edit?tab=t.0',
    notes: [
      '原本をコピーして作成してください',
      '【甲の会社名・団体名】等のプレースホルダーを置換してください'
    ]
  },
  // ... 残り11ステップを定義
];

export const milestones: Milestone[] = [
  { stepNumber: 1, label: '情報' },
  { stepNumber: 3, label: '契約' },
  { stepNumber: 7, label: '完了' },
  { stepNumber: 9, label: '入金' },
  { stepNumber: 13, label: '掲載' }
];
```

### data/email-templates.ts

```typescript
import { EmailTemplate } from '@/types/workflow';

export const emailTemplates: Record<string, EmailTemplate> = {
  '契約書送信完了メール': {
    id: 'contract-send-complete',
    subject: '【重要】契約書類2点のご確認をお願いいたします',
    body: `〇〇様

いつもお世話になっております。
株式会社ゆめスタの飯田でございます。

この度は、弊社「ゆめスタマガジン」への広告掲載に
お申し込みいただき、誠にありがとうございます。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【契約書類のご確認について】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

マネーフォワードより、以下2点の契約書類を
お送りいたしましたので、ご確認をお願いいたします。

①「広告掲載基本契約書」
②「広告掲載申込書兼個別契約書」

※マネーフォワードからのメールが届いておりますので、
　そちらのリンクから書類をご確認いただけます。

...

株式会社ゆめスタ
飯田思遠
TEL: 090-4264-9939
Email: info@yumesuta.com`
  },

  '入金確認メール': {
    id: 'payment-confirm',
    subject: '入金確認のご連絡・原稿情報のご提出について',
    body: `〇〇様

お世話になっております。
株式会社ゆめスタの飯田です。

この度は、ご入金いただきありがとうございました。
入金を確認いたしましたので、ご連絡申し上げます。

...`
  }
};
```

---

## 🚀 Phase 1（MVP）実装範囲

### ✅ 実装する機能

#### **ページ構造**
- `app/dashboard/workflow/contract/page.tsx` の作成
- メインダッシュボード（`app/page.tsx`）に「バックオフィス業務フロー」タブ追加

#### **UI機能**
- プログレスバー（スクロール追従・半透明背景）
- 5カラムカードグリッド（レスポンシブ対応）
- Notion風サイドパネル（右からスライドイン）
- カードの状態別スタイル（完了・進行中・未着手）

#### **インタラクション機能**
- カードクリックでサイドパネル展開
- チェックリスト機能（LocalStorage保存）
- メール例文モーダル表示＋コピー機能
- 外部リンクボタン（原本URL、マネーフォワード等）
- 手動更新ボタン

#### **データ連動（読み取りのみ）**
- 契約・入金管理シートのデータ取得・表示
- テーブル形式での一覧表示

#### **静的データ**
- 13ステップの詳細情報（`/data/contract-workflow.ts`）
- メール例文（`/data/email-templates.ts`）
- LocalStorageでの進捗状態保存

### ❌ Phase 2以降に延期

- スプレッドシートへの書き込み（日付記録等）
- Google Driveへのファイルアップロード
- Google Driveファイル一覧の取得・表示
- 入力フォームからのスプレッドシート更新
- 自動リマインダー機能
- 複数契約の同時管理

---

## 🔍 フェーズ4で追加調査が必要な項目

実装草案が確定したので、フェーズ4で以下を詳細調査します:

### 1. 業務フローガイドの詳細

**調査対象ファイル**:
- `/mnt/c/ゆめスタバックエンド/active/契約書作成_業務フローガイド.md`
- `/mnt/c/ゆめスタバックエンド/active/契約書リーガルチェック_プロンプト.md`
- `/mnt/c/ゆめスタバックエンド/active/契約書作成_情報収集フォーマット.md`

**調査内容**:
- 13ステップの正確な手順
- 各ステップの「やること」リスト
- チェックリスト項目
- メール例文の全文
- 注意事項

**目的**: 静的データファイル（`data/contract-workflow.ts`、`data/email-templates.ts`）を正確に作成するため

---

### 2. 契約・入金管理シートの全データ構造

**調査対象**:
- スプレッドシートID: `13PzSnGekGxDWX7B1_TwczNibR6j_JxDb3UuquPX1GyQ`
- シート名: `契約・入金管理`

**調査内容**:
- 現在のサンプルデータ（すべての行）
- データの形式（日付フォーマット、金額フォーマット等）
- 空欄の扱い方
- ステータス値のバリエーション

**目的**: API実装時のデータパースロジックを正確に設計するため

---

### 3. Google Drive API の実装方法（Phase 2準備）

**調査対象**:
- 既存システムでのDrive API使用状況
- `lib/google-drive.ts` の有無と実装内容
- OAuth認証ステータスAPI（`/api/auth/status`）の詳細

**調査内容**:
- Drive APIクライアントの初期化方法
- ファイル一覧取得の実装パターン
- ファイルアップロードの実装パターン（Phase 2で必要）

**目的**: Phase 2でのDrive連動実装をスムーズに行うため

---

## 📝 実装優先順位

### Phase 1-1: 基本UI実装（最優先）
1. ページ作成（`app/dashboard/workflow/contract/page.tsx`）
2. メインダッシュボードへのタブ追加
3. プログレスバーコンポーネント
4. カードグリッドコンポーネント
5. サイドパネルコンポーネント

### Phase 1-2: インタラクション実装
1. カードクリック→サイドパネル展開
2. チェックリスト機能（LocalStorage）
3. メール例文モーダル
4. コピー機能

### Phase 1-3: データ連動実装
1. API作成（`/api/contract/list`）
2. 契約・入金管理シートのデータ取得
3. テーブル表示コンポーネント
4. 手動更新機能

### Phase 1-4: 静的データ整備
1. フェーズ4の詳細調査実施
2. `data/contract-workflow.ts` の完成
3. `data/email-templates.ts` の完成

---

## ✅ 完了条件

Phase 1が完了したと判断する条件:

- [ ] 「バックオフィス業務フロー」タブがメインダッシュボードに表示される
- [ ] 契約業務フローページに遷移できる
- [ ] プログレスバーが表示され、スクロール追従する
- [ ] 13ステップがカードグリッドで表示される
- [ ] カードクリックでサイドパネルが右からスライドイン
- [ ] サイドパネルに各ステップの詳細情報が表示される
- [ ] チェックリストをチェックでき、LocalStorageに保存される
- [ ] メール例文ボタンでモーダルが開く
- [ ] コピーボタンでメール例文がクリップボードにコピーされる
- [ ] 外部リンクボタンで原本URLが開く
- [ ] 契約・入金管理シートのデータがテーブルで表示される
- [ ] 手動更新ボタンでデータが再取得される
- [ ] 既存の6機能と同じデザインで統一されている

---

**作成日**: 2025年10月11日
**作成者**: Claude Code
**次のステップ**: フェーズ4 - 詳細データ追加調査

以上
