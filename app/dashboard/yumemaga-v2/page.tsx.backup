'use client';

import { useState } from 'react';
import Link from 'next/link';
import {
  ArrowLeft,
  Calendar,
  Upload,
  CheckCircle2,
  Clock,
  AlertCircle,
  Play,
  FileText,
  Trash2,
} from 'lucide-react';
import { NextMonthPrepSection } from '@/components/next-month/NextMonthPrepSection';
import { CategoryManagementSection } from '@/components/category-management/CategoryManagementSection';

export default function YumeMagaV2Page() {
  const [publishDate, setPublishDate] = useState('2025-11-08');
  const [selectedIssue, setSelectedIssue] = useState('2025å¹´11æœˆå·');
  const [expandedCategory, setExpandedCategory] = useState<string | null>(null);
  const [selectedCategory, setSelectedCategory] = useState('A');
  const [confirmationStatus, setConfirmationStatus] = useState<Record<string, string>>({
    A: 'not_sent',
    K: 'pending',
    H: 'approved',
  });

  // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
  const summary = {
    completed: 45,
    inProgress: 12,
    notStarted: 23,
    delayed: 3,
  };

  // æ¬¡æœˆå·æº–å‚™ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
  const nextMonthProcesses = [
    { processNo: 'S-1', name: 'ã‚†ã‚ãƒã‚¬12æœˆå·ä¼ç”»æ±ºå®š', plannedDate: '10/8', actualDate: '10/8', status: 'completed' as const },
    { processNo: 'S-2', name: 'ã‚†ã‚ãƒã‚¬12æœˆå·ä¼ç”»æ›¸ä½œæˆ', plannedDate: '10/8', actualDate: '', status: 'in_progress' as const },
    { processNo: 'A-1', name: 'ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼å®Ÿæ–½æ—¥å ±å‘Š', plannedDate: '10/9', actualDate: '', status: 'not_started' as const },
    { processNo: 'K-1', name: 'ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼â‘¡å®Ÿæ–½æ—¥å ±å‘Š', plannedDate: '10/9', actualDate: '', status: 'not_started' as const },
    { processNo: 'L-1', name: 'ä¼ç”»å†…å®¹å ±å‘Š', plannedDate: '10/10', actualDate: '', status: 'not_started' as const },
    { processNo: 'L-2', name: 'å®Ÿæ–½æ—¥å ±å‘Š', plannedDate: '10/10', actualDate: '', status: 'not_started' as const },
    { processNo: 'L-3', name: 'ãƒãƒ¼ãƒ ä½œæˆ', plannedDate: '10/11', actualDate: '', status: 'not_started' as const },
    { processNo: 'M-1', name: 'ä¼ç”»å†…å®¹å ±å‘Š', plannedDate: '10/11', actualDate: '', status: 'not_started' as const },
    { processNo: 'M-2', name: 'å®Ÿæ–½æ—¥å ±å‘Š', plannedDate: '10/12', actualDate: '', status: 'not_started' as const },
    { processNo: 'M-3', name: 'ãƒãƒ¼ãƒ ä½œæˆ', plannedDate: '10/12', actualDate: '', status: 'not_started' as const },
    { processNo: 'H-1', name: 'STARâ‘ å®Ÿæ–½æ—¥å ±å‘Š', plannedDate: '10/13', actualDate: '', status: 'not_started' as const },
    { processNo: 'I-1', name: 'STARâ‘¡å®Ÿæ–½æ—¥å ±å‘Š', plannedDate: '10/13', actualDate: '', status: 'not_started' as const },
    { processNo: 'C-1', name: 'æ–°è¦ä¼æ¥­â‘ æƒ…å ±ã‚·ãƒ¼ãƒˆä¾é ¼', plannedDate: '10/14', actualDate: '', status: 'not_started' as const },
    { processNo: 'C-3', name: 'æ–°è¦ä¼æ¥­â‘ å†™çœŸå–å¾—ä¾é ¼', plannedDate: '10/14', actualDate: '', status: 'not_started' as const },
  ];

  // ã‚«ãƒ†ã‚´ãƒªåˆ¥å·¥ç¨‹ãƒ‡ãƒ¼ã‚¿
  const categories = [
    {
      id: 'A',
      name: 'ãƒ¡ã‚¤ãƒ³è¨˜äº‹',
      progress: 60,
      completed: 3,
      total: 5,
      canvaUrl: 'https://canva.com/design/example-a',
      confirmationRequired: true, // å…ˆæ–¹ç¢ºèªãŒå¿…è¦
      processes: [
        {
          id: 'A-2',
          name: 'ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿æå‡ºãƒ»æ’®å½±',
          plannedDate: '9/28',
          actualDate: '',
          status: 'delayed',
        },
        {
          id: 'A-3',
          name: 'ãƒ¡ã‚¤ãƒ³æ–‡å­—èµ·ã“ã—',
          plannedDate: '9/29',
          actualDate: '9/29',
          status: 'completed',
        },
        {
          id: 'A-4',
          name: 'ãƒ¡ã‚¤ãƒ³å†…å®¹æ•´ç†',
          plannedDate: '9/30',
          actualDate: '',
          status: 'in_progress',
        },
        {
          id: 'A-5',
          name: 'ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼æŠ½å‡º',
          plannedDate: '9/30',
          actualDate: '',
          status: 'not_started',
        },
        {
          id: 'A-6',
          name: 'è¡¨ç´™ãƒ‡ã‚¶ã‚¤ãƒ³æ¡ˆä½œæˆ',
          plannedDate: '10/1',
          actualDate: '10/1',
          status: 'completed',
        },
      ],
      requiredData: [
        { type: 'audio', name: 'éŒ²éŸ³ãƒ‡ãƒ¼ã‚¿', status: 'submitted', deadline: '9/28' },
        { type: 'document', name: 'æ–‡å­—èµ·ã“ã—', status: 'pending', deadline: '9/29', optional: true },
        { type: 'image', name: 'å†™çœŸç”»åƒ', status: 'submitted', deadline: '9/28' },
      ],
    },
    {
      id: 'K',
      name: 'ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼â‘¡',
      progress: 25,
      completed: 1,
      total: 4,
      canvaUrl: null,
      confirmationRequired: true,
      processes: [
        {
          id: 'K-2',
          name: 'ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼â‘¡ãƒ‡ãƒ¼ã‚¿æå‡º',
          plannedDate: '9/28',
          actualDate: '',
          status: 'delayed',
        },
        {
          id: 'K-3',
          name: 'ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼â‘¡æ–‡å­—èµ·ã“ã—',
          plannedDate: '9/29',
          actualDate: '',
          status: 'not_started',
        },
        {
          id: 'K-4',
          name: 'ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼â‘¡å†…å®¹æ•´ç†',
          plannedDate: '9/30',
          actualDate: '',
          status: 'not_started',
        },
        {
          id: 'K-5',
          name: 'ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼â‘¡ãƒšãƒ¼ã‚¸åˆ¶ä½œ',
          plannedDate: '10/2',
          actualDate: '10/2',
          status: 'completed',
        },
      ],
      requiredData: [
        { type: 'audio', name: 'éŒ²éŸ³ãƒ‡ãƒ¼ã‚¿', status: 'pending', deadline: '9/28' },
        { type: 'document', name: 'æ–‡å­—èµ·ã“ã—', status: 'none', deadline: '9/29', optional: true },
        { type: 'image', name: 'å†™çœŸç”»åƒ', status: 'submitted', deadline: '9/28' },
      ],
    },
    {
      id: 'H',
      name: 'STARâ‘ ',
      progress: 100,
      completed: 4,
      total: 4,
      canvaUrl: 'https://canva.com/design/example-h',
      confirmationRequired: true,
      processes: [
        {
          id: 'H-2',
          name: 'STARâ‘ ãƒ‡ãƒ¼ã‚¿æå‡º',
          plannedDate: '9/27',
          actualDate: '9/27',
          status: 'completed',
        },
        {
          id: 'H-3',
          name: 'STARâ‘ æ–‡å­—èµ·ã“ã—',
          plannedDate: '9/28',
          actualDate: '9/28',
          status: 'completed',
        },
        {
          id: 'H-4',
          name: 'STARâ‘ å†…å®¹æ•´ç†',
          plannedDate: '9/29',
          actualDate: '9/29',
          status: 'completed',
        },
        {
          id: 'H-5',
          name: 'STARâ‘ ãƒšãƒ¼ã‚¸åˆ¶ä½œ',
          plannedDate: '10/1',
          actualDate: '10/1',
          status: 'completed',
        },
      ],
      requiredData: [
        { type: 'audio', name: 'éŒ²éŸ³ãƒ‡ãƒ¼ã‚¿', status: 'submitted', deadline: '9/27' },
        { type: 'document', name: 'æ–‡å­—èµ·ã“ã—', status: 'submitted', deadline: '9/28', optional: true },
        { type: 'image', name: 'å†™çœŸç”»åƒ', status: 'submitted', deadline: '9/27' },
      ],
    },
    {
      id: 'Z',
      name: 'å…¨ä½“é€²æ—',
      progress: 0, // å‹•çš„è¨ˆç®—
      completed: 0,
      total: 0,
      canvaUrl: null,
      confirmationRequired: false, // Zã¯ç¢ºèªé€ä»˜ãªã—
      processes: [],
      requiredData: [],
    },
  ];

  const handleGenerateSchedule = () => {
    alert(`${publishDate}ã‹ã‚‰ã®é€†ç®—ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æœªå®Ÿè£…ï¼‰`);
  };

  const handleSaveProgress = () => {
    alert('å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã™ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æœªå®Ÿè£…ï¼‰');
  };

  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const files = e.target.files;
    if (files) {
      alert(`${files.length}ä»¶ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æœªå®Ÿè£…ï¼‰`);
    }
  };

  const handleOpenDrive = (categoryId: string) => {
    alert(`Googleãƒ‰ãƒ©ã‚¤ãƒ–: /ã‚†ã‚ãƒã‚¬/${selectedIssue}/ã‚«ãƒ†ã‚´ãƒª${categoryId}/ ã‚’é–‹ãã¾ã™ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æœªå®Ÿè£…ï¼‰`);
  };

  const handleOpenCanva = (canvaUrl: string | null) => {
    if (canvaUrl) {
      alert(`Canvaãƒšãƒ¼ã‚¸ã‚’é–‹ãã¾ã™: ${canvaUrl}ï¼ˆå®Ÿè£…æ™‚ã¯ window.openï¼‰`);
    } else {
      alert(`Canvaãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã€Œ${selectedIssue}ã€ã‚’é–‹ãã¾ã™ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æœªå®Ÿè£…ï¼‰`);
    }
  };

  const getDataStatusIcon = (status: string) => {
    switch (status) {
      case 'submitted':
        return 'âœ…';
      case 'pending':
        return 'âš ï¸';
      default:
        return 'ï¼';
    }
  };

  const getConfirmationStatusBadge = (status: string) => {
    switch (status) {
      case 'approved':
        return <span className="text-xs px-2 py-1 bg-green-100 text-green-700 rounded font-semibold">âœ… ç¢ºèªOK</span>;
      case 'pending':
        return <span className="text-xs px-2 py-1 bg-yellow-100 text-yellow-700 rounded font-semibold">â³ ç¢ºèªå¾…ã¡</span>;
      default:
        return <span className="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded">æœªé€ä»˜</span>;
    }
  };

  const handleUpdateConfirmation = (categoryId: string, status: string) => {
    setConfirmationStatus({ ...confirmationStatus, [categoryId]: status });
    alert(`ã‚«ãƒ†ã‚´ãƒª${categoryId}ã®ç¢ºèªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã€Œ${status}ã€ã«æ›´æ–°ã—ã¾ã—ãŸï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æœªå®Ÿè£…ï¼‰`);
  };

  const handleNextMonthRefresh = () => {
    alert('æ¬¡æœˆå·æº–å‚™ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æœªå®Ÿè£…ï¼‰');
  };

  const handleNextMonthUpdateActualDate = async (processNo: string, date: string) => {
    alert(`æ¬¡æœˆå·å·¥ç¨‹${processNo}ã®å®Ÿç¸¾æ—¥ã‚’ã€Œ${date}ã€ã«æ›´æ–°ã—ã¾ã—ãŸï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æœªå®Ÿè£…ï¼‰`);
  };

  // ã‚«ãƒ†ã‚´ãƒªZã®é€²æ—ã‚’è¨ˆç®—
  const calculateOverallProgress = () => {
    const nonZCategories = categories.filter(c => c.id !== 'Z');
    const totalProgress = nonZCategories.reduce((sum, cat) => sum + cat.progress, 0);
    const avgProgress = totalProgress / nonZCategories.length;

    const completedCategories = nonZCategories.filter(cat =>
      cat.progress === 100 && confirmationStatus[cat.id] === 'approved'
    ).length;

    return {
      progress: Math.round(avgProgress),
      completed: completedCategories,
      total: nonZCategories.length,
    };
  };

  const overallProgress = calculateOverallProgress();

  const getStatusBadge = (status: string) => {
    switch (status) {
      case 'completed':
        return (
          <span className="inline-flex items-center gap-1 px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-semibold">
            <CheckCircle2 className="w-4 h-4" />
            å®Œäº†
          </span>
        );
      case 'in_progress':
        return (
          <span className="inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold">
            <Clock className="w-4 h-4" />
            é€²è¡Œä¸­
          </span>
        );
      case 'delayed':
        return (
          <span className="inline-flex items-center gap-1 px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-semibold">
            <AlertCircle className="w-4 h-4" />
            é…å»¶
          </span>
        );
      default:
        return (
          <span className="px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm font-semibold">
            æœªç€æ‰‹
          </span>
        );
    }
  };

  return (
    <div className="min-h-screen bg-gray-50">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <div className="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div className="max-w-7xl mx-auto px-6 py-4">
          <Link
            href="/"
            className="inline-flex items-center gap-2 text-blue-600 hover:text-blue-700 mb-3 transition-colors"
          >
            <ArrowLeft className="w-5 h-5" />
            ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹
          </Link>
          <h1 className="text-3xl font-bold text-gray-900">
            ã‚†ã‚ãƒã‚¬åˆ¶ä½œé€²æ—ç®¡ç† <span className="text-sm text-blue-600">v2.0</span>
          </h1>
          <p className="text-gray-600 mt-1">ç™ºè¡Œæ—¥é€†ç®—ãƒ»äºˆå®Ÿç®¡ç†ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã®çµ±åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</p>
        </div>
      </div>

      <div className="max-w-7xl mx-auto px-6 py-8 space-y-8">
        {/* æ–°è¦å·ä½œæˆ / æœˆå·é¸æŠ */}
        <div className="bg-white rounded-xl shadow-md p-6">
          <div className="flex items-center gap-3 mb-4">
            <Calendar className="w-6 h-6 text-blue-600" />
            <h2 className="text-xl font-bold text-gray-900">æ–°è¦å·ä½œæˆ / æœˆå·é¸æŠ</h2>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            {/* æ–°è¦ä½œæˆ */}
            <div className="border border-gray-200 rounded-lg p-4">
              <h3 className="font-semibold text-gray-900 mb-3">æ–°è¦å·ã‚’ä½œæˆ</h3>
              <div className="flex gap-3">
                <input
                  type="date"
                  value={publishDate}
                  onChange={(e) => setPublishDate(e.target.value)}
                  className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
                <button
                  onClick={handleGenerateSchedule}
                  className="flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold"
                >
                  <Play className="w-5 h-5" />
                  é€†ç®—å®Ÿè¡Œ
                </button>
              </div>
              <p className="text-sm text-gray-600 mt-2">
                ç™ºè¡Œæ—¥ã‹ã‚‰60æ—¥é–“ã®é€†ç®—ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™
              </p>
            </div>

            {/* æ—¢å­˜å·èª­ã¿è¾¼ã¿ */}
            <div className="border border-gray-200 rounded-lg p-4">
              <h3 className="font-semibold text-gray-900 mb-3">æ—¢å­˜ã®å·ã‚’èª­ã¿è¾¼ã¿</h3>
              <div className="flex gap-3">
                <select
                  value={selectedIssue}
                  onChange={(e) => setSelectedIssue(e.target.value)}
                  className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option>2025å¹´11æœˆå·</option>
                  <option>2025å¹´10æœˆå·</option>
                  <option>2025å¹´9æœˆå·</option>
                </select>
                <button className="flex items-center gap-2 px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-semibold">
                  <FileText className="w-5 h-5" />
                  èª­ã¿è¾¼ã¿
                </button>
              </div>
              <p className="text-sm text-gray-600 mt-2">
                éå»ã«ä½œæˆã—ãŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ç·¨é›†ã§ãã¾ã™
              </p>
            </div>
          </div>
        </div>

        {/* é€²æ—ã‚µãƒãƒªãƒ¼ */}
        <div className="bg-white rounded-xl shadow-md p-6">
          <h2 className="text-xl font-bold text-gray-900 mb-4">é€²æ—ã‚µãƒãƒªãƒ¼</h2>
          <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <div className="bg-green-50 border border-green-200 rounded-lg p-4">
              <div className="flex items-center justify-between">
                <span className="text-green-700 font-semibold">å®Œäº†</span>
                <CheckCircle2 className="w-5 h-5 text-green-600" />
              </div>
              <div className="text-3xl font-bold text-green-900 mt-2">{summary.completed}</div>
            </div>

            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
              <div className="flex items-center justify-between">
                <span className="text-blue-700 font-semibold">é€²è¡Œä¸­</span>
                <Clock className="w-5 h-5 text-blue-600" />
              </div>
              <div className="text-3xl font-bold text-blue-900 mt-2">{summary.inProgress}</div>
            </div>

            <div className="bg-gray-50 border border-gray-200 rounded-lg p-4">
              <div className="flex items-center justify-between">
                <span className="text-gray-700 font-semibold">æœªç€æ‰‹</span>
                <Calendar className="w-5 h-5 text-gray-600" />
              </div>
              <div className="text-3xl font-bold text-gray-900 mt-2">{summary.notStarted}</div>
            </div>

            <div className="bg-red-50 border border-red-200 rounded-lg p-4">
              <div className="flex items-center justify-between">
                <span className="text-red-700 font-semibold">é…å»¶</span>
                <AlertCircle className="w-5 h-5 text-red-600" />
              </div>
              <div className="text-3xl font-bold text-red-900 mt-2">{summary.delayed}</div>
            </div>
          </div>
        </div>

        {/* æ¬¡æœˆå·äº‹å‰æº–å‚™ */}
        <NextMonthPrepSection
          currentMonthIssue={selectedIssue}
          nextMonthIssue="2025å¹´12æœˆå·"
          processes={nextMonthProcesses}
          onRefresh={handleNextMonthRefresh}
          onUpdateActualDate={handleNextMonthUpdateActualDate}
        />

        {/* ã‚«ãƒ†ã‚´ãƒªåˆ¥äºˆå®Ÿç®¡ç† */}
        <CategoryManagementSection
          categories={categories}
          confirmationStatus={confirmationStatus}
          expandedCategory={expandedCategory}
          onSave={handleSaveProgress}
          onOpenDrive={handleOpenDrive}
          onOpenCanva={handleOpenCanva}
          onUpdateConfirmation={handleUpdateConfirmation}
          onToggleExpand={(categoryId) =>
            setExpandedCategory(expandedCategory === categoryId ? null : categoryId)
          }
        />
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-xl font-bold text-gray-900">ã‚«ãƒ†ã‚´ãƒªåˆ¥äºˆå®Ÿç®¡ç†</h2>
            <button
              onClick={handleSaveProgress}
              className="flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold"
            >
              <Save className="w-5 h-5" />
              ä¸€æ‹¬ä¿å­˜
            </button>
          </div>

          {/* å…¨ä½“é€²æ—ã‚«ãƒ¼ãƒ‰ï¼ˆå¸¸ã«è¡¨ç¤ºï¼‰ */}
          <div className="mb-6">
            <div className="border-2 border-purple-300 rounded-lg overflow-hidden bg-purple-50">
              <div className="bg-gradient-to-r from-purple-100 to-purple-200 p-4 border-b border-purple-300">
                <div className="flex items-center justify-between mb-2">
                  <h3 className="font-bold text-gray-900 text-lg">
                    ã‚«ãƒ†ã‚´ãƒªZ: å…¨ä½“é€²æ—
                  </h3>
                  <span className="text-2xl font-bold text-purple-600">{overallProgress.progress}%</span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                  <div
                    className="bg-purple-600 h-2.5 rounded-full transition-all"
                    style={{ width: `${overallProgress.progress}%` }}
                  ></div>
                </div>
                <p className="text-sm text-gray-700">
                  {overallProgress.completed}/{overallProgress.total}ã‚«ãƒ†ã‚´ãƒªå®Œå…¨å®Œäº†
                </p>
              </div>
              <div className="p-4">
                <h4 className="font-semibold text-sm text-gray-900 mb-3">å„ã‚«ãƒ†ã‚´ãƒªã®çŠ¶æ³</h4>
                <div className="space-y-2">
                  {categories.filter(c => c.id !== 'Z').map(c => {
                    const isComplete = c.progress === 100 && confirmationStatus[c.id] === 'approved';
                    return (
                      <div key={c.id} className="flex items-center justify-between text-sm">
                        <span className="text-gray-700">
                          {isComplete ? 'âœ…' : 'âš ï¸'} {c.id}: {c.name}
                        </span>
                        <span className="text-gray-600">{c.progress}%</span>
                      </div>
                    );
                  })}
                </div>
                <p className="text-xs text-gray-500 mt-3">
                  â€»Zã¯å„ã‚«ãƒ†ã‚´ãƒªã®é›†ç´„ã®ã¿ã€‚ç‹¬è‡ªã®ç¢ºèªé€ä»˜ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
                </p>
              </div>
            </div>
          </div>

          {/* æŠ˜ã‚ŠãŸãŸã¿ãƒœã‚¿ãƒ³ */}
          <div className="mb-6 flex justify-center">
            <button
              onClick={() => setShowCategoryCards(!showCategoryCards)}
              className="flex items-center gap-2 px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-semibold"
            >
              {showCategoryCards ? (
                <>
                  <ChevronUp className="w-5 h-5" />
                  ã‚«ãƒ†ã‚´ãƒªè©³ç´°ã‚’é–‰ã˜ã‚‹
                </>
              ) : (
                <>
                  <ChevronDown className="w-5 h-5" />
                  ã‚«ãƒ†ã‚´ãƒªè©³ç´°ã‚’é–‹ã
                </>
              )}
            </button>
          </div>

          {/* ã‚«ãƒ†ã‚´ãƒªã‚«ãƒ¼ãƒ‰ä¸€è¦§ï¼ˆæŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ï¼‰ */}
          {showCategoryCards && (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {categories.filter(c => c.id !== 'Z').map((category) => {
              return (
                <div
                  key={category.id}
                  className="border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-shadow"
                >
                  {/* ã‚«ãƒ¼ãƒ‰ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                  <div className="bg-gradient-to-r from-blue-50 to-blue-100 p-4 border-b border-gray-200">
                    <div className="flex items-center justify-between mb-2">
                      <h3 className="font-bold text-gray-900 text-lg">
                        ã‚«ãƒ†ã‚´ãƒª{category.id}: {category.name}
                      </h3>
                      <span className="text-2xl font-bold text-blue-600">{category.progress}%</span>
                    </div>
                    <div className="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                      <div
                        className="bg-blue-600 h-2.5 rounded-full transition-all"
                        style={{ width: `${category.progress}%` }}
                      ></div>
                    </div>
                    <p className="text-sm text-gray-600">
                      {category.completed}/{category.total}å·¥ç¨‹å®Œäº†
                    </p>
                  </div>

                {/* æ“ä½œãƒœã‚¿ãƒ³ */}
                <div className="p-4 bg-gray-50 border-b border-gray-200">
                  <div className="flex gap-2">
                    <button
                      onClick={() => handleOpenDrive(category.id)}
                      className="flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-semibold"
                    >
                      <Folder className="w-4 h-4" />
                      Drive
                    </button>
                    <button
                      onClick={() => handleOpenCanva(category.canvaUrl)}
                      className="flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-semibold"
                    >
                      ğŸ¨ Canva
                    </button>
                  </div>
                  {!category.canvaUrl && (
                    <p className="text-xs text-gray-500 mt-2 text-center">
                      â€»æœªç™»éŒ²ã®ãŸã‚ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ç§»å‹•
                    </p>
                  )}
                </div>

                {/* å…ˆæ–¹ç¢ºèªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */}
                {category.confirmationRequired && (
                  <div className="p-4 bg-gray-50 border-b border-gray-200">
                    <h4 className="font-semibold text-sm text-gray-900 mb-2">ğŸ“‹ å…ˆæ–¹ç¢ºèªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h4>
                    <div className="mb-2">
                      {getConfirmationStatusBadge(confirmationStatus[category.id] || 'not_sent')}
                    </div>
                    <select
                      value={confirmationStatus[category.id] || 'not_sent'}
                      onChange={(e) => handleUpdateConfirmation(category.id, e.target.value)}
                      className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="not_sent">æœªé€ä»˜</option>
                      <option value="pending">ç¢ºèªå¾…ã¡</option>
                      <option value="approved">ç¢ºèªOK</option>
                    </select>
                  </div>
                )}

                {/* å±•é–‹ãƒœã‚¿ãƒ³ */}
                <div className="p-4">
                  <button
                    onClick={() =>
                      setExpandedCategory(expandedCategory === category.id ? null : category.id)
                    }
                    className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-semibold"
                  >
                    {expandedCategory === category.id ? 'é–‰ã˜ã‚‹ â–²' : 'å·¥ç¨‹è©³ç´°ã‚’é–‹ã â–¼'}
                  </button>
                </div>

                {/* å·¥ç¨‹è©³ç´°ï¼ˆå±•é–‹æ™‚ï¼‰ */}
                {expandedCategory === category.id && (
                  <div className="px-4 pb-4">
                    <div className="space-y-2">
                      {category.processes.map((process) => (
                        <div
                          key={process.id}
                          className="border border-gray-200 rounded-lg p-3 bg-white"
                        >
                          <div className="flex items-start justify-between mb-2">
                            <div className="flex-1">
                              <p className="font-semibold text-sm text-gray-900">{process.name}</p>
                              <p className="text-xs text-gray-500 mt-1">
                                äºˆå®š: {process.plannedDate}
                              </p>
                            </div>
                            <div className="ml-2">{getStatusBadge(process.status)}</div>
                          </div>
                          <input
                            type="text"
                            placeholder="å®Ÿç¸¾æ—¥ã‚’å…¥åŠ›"
                            defaultValue={process.actualDate}
                            className="w-full px-3 py-1.5 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                          />
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
              );
            })}
            </div>
          )}
        </div>

        {/* ãƒ‡ãƒ¼ã‚¿æå‡ºé€²æ—ç®¡ç† */}
        <div className="bg-white rounded-xl shadow-md p-6">
          <div className="flex items-center gap-3 mb-6">
            <Upload className="w-6 h-6 text-blue-600" />
            <h2 className="text-xl font-bold text-gray-900">ãƒ‡ãƒ¼ã‚¿æå‡ºé€²æ—ç®¡ç†</h2>
          </div>

          {/* ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ */}
          <div className="border border-gray-200 rounded-lg p-6 mb-6">
            <div className="mb-4">
              <label className="block text-sm font-semibold text-gray-700 mb-2">
                ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ
              </label>
              <select
                value={selectedCategory}
                onChange={(e) => setSelectedCategory(e.target.value)}
                className="w-full max-w-md px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                {categories.map((c) => (
                  <option key={c.id} value={c.id}>
                    ã‚«ãƒ†ã‚´ãƒª{c.id}: {c.name}
                  </option>
                ))}
              </select>
            </div>

            <div className="bg-blue-50 border-2 border-dashed border-blue-300 rounded-lg p-8 text-center">
              <Upload className="w-12 h-12 text-blue-400 mx-auto mb-3" />
              <p className="text-gray-700 mb-2">
                <label className="cursor-pointer text-blue-600 hover:text-blue-700 font-semibold">
                  ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                  <input
                    type="file"
                    multiple
                    onChange={handleFileUpload}
                    className="hidden"
                  />
                </label>
                {' '}ã¾ãŸã¯ ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
              </p>
              <p className="text-sm text-gray-500">
                ã‚«ãƒ†ã‚´ãƒª{selectedCategory}ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
              </p>
            </div>
          </div>

          {/* ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ‡ãƒ¼ã‚¿æå‡ºçŠ¶æ³ */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {categories.map((category) => {
              const hasDeadlinePassed = category.requiredData.some(
                (data) => data.status === 'pending' && !data.optional
              );

              return (
                <div
                  key={category.id}
                  className={`border rounded-lg overflow-hidden ${
                    hasDeadlinePassed ? 'border-red-300 bg-red-50' : 'border-gray-200 bg-white'
                  }`}
                >
                  {/* ã‚«ãƒ†ã‚´ãƒªãƒ˜ãƒƒãƒ€ãƒ¼ */}
                  <div
                    className={`p-4 border-b ${
                      hasDeadlinePassed
                        ? 'bg-red-100 border-red-200'
                        : 'bg-gray-50 border-gray-200'
                    }`}
                  >
                    <h3 className="font-bold text-gray-900">
                      ã‚«ãƒ†ã‚´ãƒª{category.id}: {category.name}
                    </h3>
                    <p
                      className={`text-sm mt-1 ${
                        hasDeadlinePassed ? 'text-red-700 font-semibold' : 'text-gray-600'
                      }`}
                    >
                      {hasDeadlinePassed ? 'âš ï¸ æœŸé™è¶…éã‚ã‚Š' : 'âœ… é †èª¿'}
                    </p>
                  </div>

                  {/* ãƒ‡ãƒ¼ã‚¿ä¸€è¦§ */}
                  <div className="p-4 space-y-3">
                    {category.requiredData.map((data, index) => (
                      <div
                        key={index}
                        className="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200"
                      >
                        <div className="flex-1">
                          <div className="flex items-center gap-2 mb-1">
                            <span className="text-lg">{getDataStatusIcon(data.status)}</span>
                            <p className="font-semibold text-sm text-gray-900">{data.name}</p>
                            {data.optional && (
                              <span className="text-xs px-2 py-0.5 bg-gray-200 text-gray-600 rounded">
                                ä»»æ„
                              </span>
                            )}
                          </div>
                          <p className="text-xs text-gray-500">ã€†åˆ‡: {data.deadline}</p>
                        </div>
                        <div className="ml-2">
                          {data.status === 'submitted' ? (
                            <span className="text-xs px-2 py-1 bg-green-100 text-green-700 rounded font-semibold">
                              æå‡ºæ¸ˆã¿
                            </span>
                          ) : data.status === 'pending' ? (
                            <span className="text-xs px-2 py-1 bg-red-100 text-red-700 rounded font-semibold">
                              æœªæå‡º
                            </span>
                          ) : (
                            <span className="text-xs px-2 py-1 bg-gray-100 text-gray-500 rounded">
                              ï¼
                            </span>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              );
            })}
          </div>
        </div>

        {/* ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆï¼ˆç°¡æ˜“ç‰ˆãƒ»å¾Œã§å®Ÿè£…ï¼‰ */}
        <div className="bg-white rounded-xl shadow-md p-6">
          <h2 className="text-xl font-bold text-gray-900 mb-4">ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆï¼ˆå…¨æœŸé–“ï¼‰</h2>
          <div className="bg-gray-100 border border-gray-300 rounded-lg p-12 text-center">
            <Calendar className="w-16 h-16 text-gray-400 mx-auto mb-4" />
            <p className="text-gray-600">ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã¯æ¬¡ãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè£…ã—ã¾ã™</p>
            <p className="text-sm text-gray-500 mt-2">
              æ—¢å­˜ã® /dashboard/yumemaga ã®ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã‚’å‚è€ƒã«å…¨æœŸé–“è¡¨ç¤ºã«å¯¾å¿œ
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}
